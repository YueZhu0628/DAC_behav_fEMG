---
title: "DACFE_Data_Analysis"
authro: "Yue Zhu"
output:
  html_notebook
---
# Prepare working environment
```{r}
rm(list = ls())
```

set working directory
```{r}
getwd()
setwd("E:/Dissertation/Methods/Exp2_Demand_Choice/Analysis/Exp2_Data_Analysis")
# getwd()
```

```{r Library Packages, include=FALSE}
library(dplyr)
library(tidyr)
library(rstatix)
library(psych)
# library(lattice)
library(ggplot2)
library(ggrepel)
library(ggpubr)
library(ggsci)
library(sjPlot)
# library(ggeffects)
# library(webshot)
library(ez)
library(BayesFactor)
library(lme4)
# library(blme)
library(lmerTest)
# library(emmeans)
# library(afex)
# library(performance) # check for assumptions of statistical analyses
# library(grid)
# library(mediation)
```

(1) Behavioral, (2) fEMG, and (3) questionnaires data of each participant have been pre-processed, and then combined into one .csv file. /n


 ### ------------------------------------------------------------------------------------- ###
# DATA ANALYSIS
## Load data
```{r}
DataInput <- function(p_comb_data_file){
  p_df <- read.csv(p_comb_data_file)
  # print(colnames(p_df))
  select_cols <- c("PID", "Gender", "Age", "CueMapping",
                   # Procedure Info
                   "Phase", "Block", "TrialN", "NbackLevel", "ISI", 
                   # Calibration Info
                   "ISI_calibrated", "CaliEnd_A_measure",
                   # Trial Performance
                   "Task_A_measure", "Task_ACC",
                   "Task_RT", "Task_RT_z",
                   # Learning Phase (Test) rating
                   "CueLearning", "TrialDemandLearning",
                   "cue_i_on_zyg_values", "cue_i_on_zyg_zvalues",
                   "cue_e_on_zyg_values", "cue_e_on_zyg_zvalues",
                   "cue_i_on_cor_values", "cue_i_on_cor_zvalues",
                   "cue_e_on_cor_values", "cue_e_on_cor_zvalues",
                   "cue_i_on_scr_values", "cue_i_on_scr_zvalues",
                   "cue_e_on_scr_values", "cue_e_on_scr_zvalues",
                   # True & False choice 
                   "PhaseType",
                   "Choice", ## position: left or right
                   "ChoiceDemand", "TaskDemand", ## demand: easy or hard (middle)
                   "ChoiceRT", 
                   "cue_e_true_zyg_values","cue_e_true_zyg_zvalues",
                   "cue_e_true_cor_values","cue_e_true_cor_zvalues",
                   "cue_e_true_scr_values","cue_e_true_scr_zvalues",
                   "cue_e_false_zyg_values","cue_e_false_zyg_zvalues",
                   "cue_e_false_cor_values","cue_e_false_cor_zvalues",
                   "cue_e_false_scr_values","cue_e_false_scr_zvalues",
                   # Offline Rating T0, T1, T2, T3
                   "OfflineRatingTimePoint",
                   "TrialDemand", ## demand the cue associated before
                   "OfflineRating", "OfflineRating_z", 
                   "OfflineRatingRT",
                   "cue_i_off_zyg_values","cue_i_off_zyg_zvalues",
                   "cue_i_off_cor_values","cue_i_off_cor_zvalues",
                   "cue_i_off_scr_values","cue_i_off_scr_zvalues",
                   # Learning check T1, T2
                   "CueCheck", "CueDemandCheck", "CorrectAnswer", 
                   "Answer", "AnswerDemand", "AnswerRT", "AnswerACC",
                   # Demand Rating 
                   "DemandRatingQuesIndex", "QuesTLX", "DemandLevel", 
                   "DemandRating","DemandRating_z", "DemandRatingRT", 
                   # Questionnaires
                   "BAI_bis","BAI_bas_d","BAI_bas_rr","BAI_bas_fs",
                   "NFC",
                   "BFI_ext" ,"BFI_agr","BFI_con","BFI_neu","BFI_open",
                   "UPPS_lps","UPPS_lpm","UPPS_pu","UPPS_ss" )
  # for (col in select_cols){
  #   check <- col %in% colnames(p_df)
  #   if (! check){
  #    print(c(col, check))
  #   }
  # }
  p_df_selected <- p_df[, select_cols]
  return(p_df_selected)
}
```


```{r Load Data_v2}
data_folder <- "E:/Dissertation/Methods/Exp2_Demand_Choice/Analysis/Exp2_Data_Analysis/Combined_Data"
p_files <- list.files(data_folder, pattern = "csv", full.names = TRUE)
PIDS = list()
data_all = list()
for (p_file in p_files){
  pid = substr(basename(p_file), 1,3)
  PIDS <- append(PIDS, c(pid))
  p_data <- DataInput(p_file)
  data_all[[pid]] <- p_data  # R中用元素名称作为索引
}
df_all <- do.call(rbind, data_all)
```


```{r}
write.csv(df_all, na = "",
          file = "E:/Dissertation/Methods/Exp2_Demand_Choice/Analysis/Exp2_Data_Analysis/df_all.csv")
```



## Preprocess the whole dataframe
```{r}
# check for participants who didn't learned the association
df_LearningCheck <-
  df_all %>%
  filter(Phase == "LEARNINGCHECK")

failedLearningPIDs <-
  df_LearningCheck$PID[df_LearningCheck$AnswerACC==0] %>%
  unique()
failedLearningPIDs

```

```{r}
excludedPIDs <- failedLearningPIDs
# add the excluded PIDs due to some other problems
# PID 8 chose easy all the time
excludedPIDs <-
  c(failedLearningPIDs,8)
```


## Clean dataframe: df_clean
Z scores were scaled by the means of each participant
```{r}
df_clean <- 
  df_all %>% 
  filter(!PID %in% excludedPIDs) %>%
  group_by(PID) %>% 
  mutate(TaskDemand = ifelse(Phase %in% c("TrueCHOICE", "FalseCHOICE"), 
                             TaskDemand, TrialDemandLearning),
         TaskDemand = factor(TaskDemand)) %>%
  # mutate(TrialDemandLearning_code = ifelse(TrialDemandLearning=="Easy",0,1),
  #        TaskDemand_code = ifelse(TaskDemand=="Easy",0,ifelse(TaskDemand=="Hard",1,2))) %>% 
  # mutate(pre_RT_z = c(scale(Task_RT_pre, center = TRUE, scale = TRUE)),
  #        pre_ACC = c(scale(Task_ACC_pre, center = TRUE, scale = TRUE))) %>%
  ungroup()

# write.csv(df_all_clean, na = "",
#           file = ("E:/Dissertation/Methods/Exp2_Demand_Choice/Analysis/Exp2_Data_Analysis/df_all_clean.csv")
```


```{r}
df_Indi <- 
  df_clean %>% 
  filter(Phase %in% c("PRACTICE"))

df_Learning <- 
  df_clean %>% 
  filter(Phase %in% c("LEARNING"))

df_True_Choice <- 
  df_clean %>% 
  filter(Phase %in% c("TrueCHOICE"))

df_False_Choice <- 
  df_clean %>% 
  filter(Phase %in% c("FalseCHOICE"))

df_Offlines <- 
  df_clean %>% 
  filter(Phase == "OFFLINERATING")

df_DemandRating <-
  df_clean %>%
  filter(Phase == "DEMANDRATING")
```


```{r}
df_Indi %>% 
  ggplot(aes(x=factor(sort(ISI))))+
  geom_bar(position = position_dodge(width = 0.7) ,
           width = 0.6, alpha=0.6, fill="darkgreen")+
  labs(title = "Calibrated ISI", x = "ISI") +
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))
```

```{r}
print(df_Indi$PID[df_Indi$ISI == 2583])
# output: [1] 8 17 34 35 51
```

```{r}
table(df_Indi$Gender)
```


## Performance
```{r}
indi_hist_plot <- function(df_clean, indicator, gb=NA){
  if(!is.na(gb)){
    df_clean %>%
      filter(Phase %in% c("LEARNING","TrueCHOICE","FalseCHOICE")) %>%
      group_by(!!sym(gb)) %>% 
      mutate(indi_mean = mean(!!sym(indicator), na.rm=TRUE)) %>%
      ggplot(aes(!!sym(indicator),
              color = .data[[gb]], fill = .data[[gb]])) +
      geom_histogram()+
      scale_color_lancet()+
      scale_fill_lancet(alpha = 0.5)+
      geom_vline(aes(xintercept=indi_mean))+
      facet_wrap(~.data[[gb]])+
      labs(title = indicator, x = indicator)
  }else{
    df_clean %>%
      filter(Phase %in% c("LEARNING","TrueCHOICE","FalseCHOICE")) %>%
      mutate(indi_mean = mean(!!sym(indicator), na.rm=TRUE)) %>%
      ggplot(aes(!!sym(indicator))) +
      geom_histogram()+
      geom_vline(aes(xintercept=indi_mean))+
      labs(title = indicator, x = indicator)
  }
}
```

```{r}
t_test_within <- function(df_clean, indicator, gb){
  t_ds <- 
    df_clean %>% 
    filter(Phase %in% c("LEARNING","TrueCHOICE","FalseCHOICE")) %>% 
    group_by(PID) %>% 
    t_test(!!sym(indicator)~!!sym(gb))
}
```


```{r}
indi_bar_plot <- function(df_clean, indicator, gb, demands=TRUE){
  if(demands == FALSE){
    df <- 
      df_clean %>%
      filter(Phase %in% c("LEARNING","TrueCHOICE","FalseCHOICE")) %>% 
      group_by(PID) %>%
      summarise(indi_mean = mean(!!sym(indicator), na.rm=TRUE), .groups = "drop")
  }else{
    df <-
      df_clean %>%
      filter(Phase %in% c("LEARNING","TrueCHOICE","FalseCHOICE")) %>%
      group_by(PID, !!sym(gb)) %>%
      summarise(indi_mean = mean(!!sym(indicator), na.rm=TRUE), .groups = "drop")
  }
  df %>% 
  mutate(PID = factor(PID)) %>% 
  ggplot(aes(x=PID, y = indi_mean,
            color = !!sym(gb), fill = !!sym(gb))) + 
  geom_bar(stat = "identity", position = position_dodge(0.9)) + 
  scale_color_lancet()+
  scale_fill_lancet(alpha = 0.5)+
  # stat_pvalue_manual(t_ds, x="PID",y.position = 5,
  #                    label = "p = {p}{p.adj.signif}", hide.ns = FALSE,
  #                     tip.length = 0, linetype = "blank") +
  labs(title = indicator, x = "PID", y = indicator) + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))
}
```

```{r}
indi_box_plot <- function(df_clean, indicator, gb, pair=TRUE, jt=FALSE){
  t_ds_group <-
    df_clean %>% 
    filter(Phase %in% c("LEARNING","TrueCHOICE","FalseCHOICE")) %>% 
    group_by(PID,!!sym(gb)) %>% 
    summarise(indi_mean=mean(!!sym(indicator), na.rm=TRUE),.groups = "drop") %>% 
    mutate(PID = factor(PID),
           TaskDemand = factor(!!sym(gb))) %>%
    t_test(indi_mean~TaskDemand, paired = pair, detailed = TRUE) %>% 
    add_xy_position(x="TaskDemand") %>% 
    add_significance()
  
  if("p.adj.signif" %in% colnames(t_ds_group)){
    plabel = "p = {p}{p.adj.signif}"
  }else{
    plabel = "p = {p}{p.signif}"
  }
  
  p <- df_clean %>% 
    filter(Phase %in% c("LEARNING","TrueCHOICE","FalseCHOICE")) %>% 
    ggplot(aes(x=!!sym(gb), y = !!sym(indicator))) + 
    geom_boxplot(aes(color = !!sym(gb), fill = !!sym(gb)), 
                 position="identity", outlier.shape = 8) +  
    scale_color_lancet()+
    scale_fill_lancet(alpha = 0.2)+
    stat_summary(fun = mean, geom = "point", 
                 shape = 17, color = "black", size = 2) +
    stat_pvalue_manual(t_ds_group,
                       bracket.nudge.y = 0.4,
                       step.increase = 0.1, 
                       label = plabel, hide.ns = FALSE,
                        tip.length = 0.01) +
    labs(title = indicator, x = gb, y = indicator, fill=gb) + 
    theme_bw() + 
    theme(plot.title = element_text(hjust = 0.5))
  if(jt==FALSE){
    p
  }else{
    p <- p+geom_jitter(aes(x=!!sym(gb), color=!!sym(gb)), 
                width=0.3, alpha=0.5)
  }
  print(p)
}
```



### Across Phases (Learning+Choice)
Histogram Plots
```{r}
indi_hist_plot(df_clean, "Task_RT", gb="TaskDemand")
indi_hist_plot(df_clean, "Task_ACC", gb="TaskDemand")
indi_hist_plot(df_clean, "Task_A_measure", gb="TaskDemand")
```

Bar Plots
```{r}
indi_bar_plot(df_clean,"Task_RT", "TaskDemand")
indi_bar_plot(df_clean,"Task_ACC", "TaskDemand")
indi_bar_plot(df_clean,"Task_A_measure", "TaskDemand")
```

Box Plots
```{r}
indi_box_plot(df_clean, "Task_RT", "TaskDemand")
indi_box_plot(df_clean, "Task_ACC", "TaskDemand")
indi_box_plot(df_clean, "Task_A_measure", "TaskDemand")
```


### Learning Phase
Bar Plots
```{r}
indi_bar_plot(df_Learning, "Task_RT", "TaskDemand")
indi_bar_plot(df_Learning, "Task_ACC", "TaskDemand")
indi_bar_plot(df_Learning, "Task_A_measure", "TaskDemand")
```

Box Plots
```{r}
indi_box_plot(df_Learning, "Task_RT", "TaskDemand")
indi_box_plot(df_Learning, "Task_ACC", "TaskDemand")
indi_box_plot(df_Learning, "Task_A_measure", "TaskDemand")
```


### True Choice Phase
Bar Plots
```{r}
indi_bar_plot(df_True_Choice, "Task_RT", "TaskDemand")
indi_bar_plot(df_True_Choice, "Task_ACC", "TaskDemand")
indi_bar_plot(df_True_Choice, "Task_A_measure", "TaskDemand")
```

Box Plots
```{r}
indi_box_plot(df_True_Choice, "Task_RT", "TaskDemand")
indi_box_plot(df_True_Choice, "Task_ACC", "TaskDemand")
indi_box_plot(df_True_Choice, "Task_A_measure", "TaskDemand")
```


### False Choice Phase
Bar Plots
```{r}
indi_bar_plot(df_False_Choice, "Task_RT", "ChoiceDemand")
indi_bar_plot(df_False_Choice, "Task_ACC", "ChoiceDemand")
indi_bar_plot(df_False_Choice, "Task_A_measure", "ChoiceDemand")
```

Box Plots
```{r}
indi_box_plot(df_False_Choice, "Task_RT", "ChoiceDemand")
indi_box_plot(df_False_Choice, "Task_ACC", "ChoiceDemand")
indi_box_plot(df_False_Choice, "Task_A_measure", "ChoiceDemand")
```



## Check for DemandRatings (Demand-Manipulation Check)
```{r}
df_dr_means_de <- 
  df_DemandRating %>% 
  group_by(PID, DemandLevel) %>% 
  summarise(DemandRating = mean(DemandRating, na.rm=TRUE),
            DemandRating_z = mean(DemandRating_z, na.rm=TRUE),
            .groups = "drop") %>% 
  mutate(DemandLevel=factor(DemandLevel))

t_dr <- 
  df_dr_means_de %>% 
  t_test(DemandRating_z ~ DemandLevel, paired = TRUE, detailed = TRUE) %>% 
  add_xy_position(x = "DemandLevel") %>% 
  add_significance()
```

boxplot
(higher rating = rated as more demanding)
```{r}
ggplot(data = df_dr_means_de, aes(x = DemandLevel, y = DemandRating_z, 
                                  color = DemandLevel)) + 
  geom_boxplot(width = 0.5, alpha = 0.7) +
  geom_jitter() + 
  stat_boxplot(geom = "errorbar", width = 0.15) +
  stat_pvalue_manual(t_dr, step.increase = 0.2, bracket.nudge.y = 0.1,
                     label = "p = {p}{p.adj.signif}", hide.ns = TRUE) +
  scale_color_manual(labels=c("1-Back", "2-Back", "3-Back"),
                     values = c("#00468BFF", "#42B540FF", "#ED0000FF")) +
  scale_x_discrete(labels = c("1-Back", "2-Back", "3-Back")) +
  labs(title = "Demand Rating t-test", x = "Task Demand", y = "Demand Rating_z", 
       color = "Demand Level") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))
```


```{r}
df_dr_means_de_trans <- 
  df_dr_means_de %>% 
  select(-DemandRating) %>% 
  pivot_wider(values_from = DemandRating_z, 
              names_from = DemandLevel, names_prefix = "DemandRating_z_") %>% 
  mutate(DR_z_diff_2_1 = DemandRating_z_2 - DemandRating_z_1,
         DR_z_diff_3_1 = DemandRating_z_3 - DemandRating_z_1,
         DR_z_diff_3_2 = DemandRating_z_3 - DemandRating_z_2) %>% 
  pivot_longer(cols=c("DR_z_diff_2_1","DR_z_diff_3_1","DR_z_diff_3_2"),
               names_to="Levels", values_to="DR_z_diff",
               names_prefix = "DR_z_diff_") %>% 
  mutate(Type_diff = ifelse(DR_z_diff>0, "harder", "easier"))
```

```{r}
df_dr_means_de_trans %>%
  ggplot(aes(x=Levels, y=DR_z_diff))+
# df_dr_means_de_trans %>% 
#   ggplot(aes(x=Levels, y=DR_z_diff,color=Type_diff,label=PID))+  
  geom_boxplot(aes(fill=Levels),
               outlier.shape = 17, alpha=0.3, width=0.4)+
  scale_fill_manual(values=c("#999999", "#E69F00", "#56B4E9"))+
  geom_jitter(aes(color=Type_diff),alpha=0.5, width=0.2)+
  # geom_label_repel(aes(color=Type_diff),
  #                  max.overlaps = nrow(df_dr_means_de_trans)) +
  scale_color_lancet()+
  geom_hline(yintercept = 0)+
  labs(title = "Demand Rating Diff between Levels")+
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))
  
```



The participant should be excluded due to rating 1-back as harder?
```{r}
# PID 10, 41, 45 rated 1-back as harder than 3-back
```




## Learning Phase fEMG
```{r}
indi_means_comp <- function(df_clean, indicator, gbg, gbd){
    df <-
      df_clean %>%
      group_by_at(gbg) %>%
      summarise_at(indicator, mean, na.rm=TRUE, .groups = "drop")
  colnames(df)[-c(1,2)] <- paste0(colnames(df)[-c(1,2)], "_diff")
  # print(df)
  df_easy <- 
    df %>% 
    filter(!!sym(gbd)=="Easy") %>% 
    select(-!!sym(gbd))
  df_hard <- 
    df %>% 
    filter(!!sym(gbd)=="Hard") %>% 
    select(-!!sym(gbd))
  df_diff <- 
    df_hard - df_easy
  df_diff$PID <- unique(df$PID)
  return(df_diff)
}
```

```{r}
df_on_phy_diffs <- indi_means_comp(df_Learning,
                                   c("cue_i_on_zyg_zvalues",
                                     "cue_i_on_cor_zvalues",
                                     "cue_i_on_scr_zvalues",
                                     "cue_e_on_zyg_zvalues",
                                     "cue_e_on_cor_zvalues",
                                     "cue_e_on_scr_zvalues"),
                                   c("PID", "TaskDemand"),
                                   "TaskDemand") 
```


### Descriptive Analysis 
#### implicit cue
```{r}
indi_hist_plot(df_Learning, "cue_i_on_zyg_zvalues")
indi_hist_plot(df_Learning, "cue_i_on_zyg_zvalues", "TaskDemand")
  # # scale_x_continuous(limits = c(-1, 1)) +
  # labs(title = "fEMG response Means of participants", x = "fEMG values (z-scored)", y = "Counts") + 
  # theme_bw() + 
  # theme(plot.title = element_text(hjust = 0.5))
```


cor
```{r}
indi_hist_plot(df_Learning, "cue_i_on_cor_zvalues", demands = FALSE)
indi_hist_plot(df_Learning, "cue_i_on_cor_zvalues", demands = TRUE)
  # # scale_x_continuous(limits = c(-1, 1)) +
  # labs(title = "fEMG response Means of participants", x = "fEMG values (z-scored)", y = "Counts") + 
  # theme_bw() + 
  # theme(plot.title = element_text(hjust = 0.5))
```


scr
```{r}
indi_hist_plot(df_Learning, "cue_i_on_scr_zvalues", demands = FALSE)
indi_hist_plot(df_Learning, "cue_i_on_scr_zvalues", demands = TRUE)
  # # scale_x_continuous(limits = c(-1, 1)) +
  # labs(title = "fEMG response Means of participants", x = "fEMG values (z-scored)", y = "Counts") + 
  # theme_bw() + 
  # theme(plot.title = element_text(hjust = 0.5))
```


#### explicit cue
```{r}
indi_hist_plot(df_Learning, "cue_e_on_zyg_zvalues", demands = FALSE)
indi_hist_plot(df_Learning, "cue_e_on_zyg_zvalues", demands = TRUE)
  # # scale_x_continuous(limits = c(-1, 1)) +
  # labs(title = "fEMG response Means of participants", x = "fEMG values (z-scored)", y = "Counts") + 
  # theme_bw() + 
  # theme(plot.title = element_text(hjust = 0.5))
```


cor
```{r}
indi_hist_plot(df_Learning, "cue_e_on_cor_zvalues", demands = FALSE)
indi_hist_plot(df_Learning, "cue_e_on_cor_zvalues", demands = TRUE)
  # # scale_x_continuous(limits = c(-1, 1)) +
  # labs(title = "fEMG response Means of participants", x = "fEMG values (z-scored)", y = "Counts") + 
  # theme_bw() + 
  # theme(plot.title = element_text(hjust = 0.5))
```

scr
```{r}
indi_hist_plot(df_Learning, "cue_e_on_scr_zvalues", demands = FALSE)
indi_hist_plot(df_Learning, "cue_e_on_scr_zvalues", demands = TRUE)
  # # scale_x_continuous(limits = c(-1, 1)) +
  # labs(title = "fEMG response Means of participants", x = "fEMG values (z-scored)", y = "Counts") + 
  # theme_bw() + 
  # theme(plot.title = element_text(hjust = 0.5))
```


```{r}
indi_bar_plot(df_Learning, "cue_i_on_zyg_zvalues", "TaskDemand")
```

```{r}
indi_box_plot(df_Learning, "cue_i_on_zyg_zvalues", "TaskDemand")
indi_box_plot(df_Learning, "cue_i_on_cor_zvalues", "TaskDemand")
indi_box_plot(df_Learning, "cue_i_on_scr_zvalues", "TaskDemand")
```

```{r}
indi_box_plot(df_Learning, "cue_e_on_zyg_zvalues", "TaskDemand")
indi_box_plot(df_Learning, "cue_e_on_cor_zvalues", "TaskDemand")
indi_box_plot(df_Learning, "cue_e_on_scr_zvalues", "TaskDemand")
```




#### physio response pairs of each participant in different demands
```{r}
indi_pair_plot <- function(df_clean, indicator, gb){
  df_clean %>% 
  filter(Phase %in% c("LEARNING","TrueCHOICE","FalseCHOICE")) %>% 
  group_by(PID,TaskDemand) %>% 
  summarise(indi_mean=mean(!!sym(indicator), na.rm=TRUE),.groups = "drop") %>% 
  mutate(PID = factor(PID),
         TaskDemand = factor(!!sym(gb))) %>% 
  ggpaired(x = "TaskDemand", y = "indi_mean", id="PID", 
           color = "TaskDemand", line.color = "grey", palette = "lancet") +
  stat_summary(fun = "mean", shape = 17) +
  stat_compare_means(method = "t.test", paired = TRUE, label = "p.format", label.x = 1.5) +
  labs(title = "Physio Resp Pairs", 
       x = "Task Demand", y = indicator, 
       color = "Task Demand") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))
}
```

```{r}
indi_pair_plot(df_Learning, "cue_i_on_zyg_zvalues", "TaskDemand")
indi_pair_plot(df_Learning, "cue_i_on_cor_zvalues", "TaskDemand")
indi_pair_plot(df_Learning, "cue_i_on_scr_zvalues", "TaskDemand")
indi_pair_plot(df_Learning, "cue_e_on_zyg_zvalues", "TaskDemand")
indi_pair_plot(df_Learning, "cue_e_on_cor_zvalues", "TaskDemand")
indi_pair_plot(df_Learning, "cue_e_on_scr_zvalues", "TaskDemand")

```


#### Demand Aversiveness 
(Easy - Hard) > 0 or < 0 
```{r}

```




#### Difference in each 10 trials 
```{r}
# review the number of easy and hard trials in each trial section
# it turns out to be relatively balanced

result_table <- 
  df_Learning %>%
  mutate(Trial_Index_Group = cut(TrialN, breaks = c(1, 10, 20, 30, 40, 50), labels = FALSE)) %>%
  group_by(PID, Trial_Index_Group, TaskDemand) %>%
  summarise(count = n(), .groups = "drop") %>%
  pivot_wider(names_from = TaskDemand, values_from = count, values_fill = 0)

# Print the resulting table
# print(result_table)

```

```{r}
# Define the sections
trial_sections <- list("10" = 1:10, "20" = 11:20, "30" = 21:30, "40" = 31:40, "50" = 41:50)
# trial_sections <- list("05" = 1:5, "10" = 6:10, 
#                        "15" = 11:15, "20" = 16:20, 
#                        "25" = 21:25, "30" = 26:30, 
#                        "35" = 31:35, "40" = 36:40, 
#                        "45" = 41:45, "50" = 46:50)
```


```{r}
section_res <- function(df_clean, gb, col_resp, sections, plot=FALSE){
  # Create a function to calculate mean for each section of trials
  section_means <- function(df_clean, col_resp, section){
    df <- 
      df_clean %>%
        group_by(PID, !!sym(gb)) %>%
        summarise(across(starts_with(col_resp),
                         ~ mean(.[TrialN %in% section], na.rm = TRUE),
                         .names = "phy_z_mean"), .groups = "drop")
  }
  # Initialize an empty list to store the results
  result_list <- list()
  
  # Use lapply to iterate over each section and calculate means
  result_list <- lapply(names(sections), function(section_name) {
    section <- trial_sections[[section_name]]
    
    # Calculate means for the current section
    result <- section_means(df_clean, col_resp, section)
    
    # Add a column indicating the section name
    result$Section <- section_name
    
    return(result)
    })
    # Combine the results into a single data frame
    df_phy_means_demands_tsecs <- bind_rows(result_list) %>% 
      mutate(Demand = !!sym(gb))

    
    if(plot){
      t_phy_set <- 
        df_phy_means_demands_tsecs %>% 
        group_by(Section) %>% 
        t_test(phy_z_mean ~ Demand, paired = TRUE, detailed = TRUE) %>% 
        add_significance() %>% 
        add_xy_position(x = "Section")
      
      df_phy_means_demands_tsecs %>% 
        ggplot(aes(x = Section, y = phy_z_mean, color = .data[[gb]])) + 
        geom_boxplot(position = "dodge2", 
                     alpha = 0.7, width = 0.5, outlier.color = "black") +
        geom_point(position = position_dodge(width = 0.5), alpha = 0.5) +
        scale_color_lancet() +
        stat_summary(fun = mean, geom = "point", aes(group = .data[[gb]]),
                 shape = 17, color="black", size = 2,
               position = position_dodge(width = 0.5)) +
        stat_pvalue_manual(t_phy_set, label = "p = {p}{p.signif}", hide.ns = FALSE,
                            tip.length = 0, linetype = "blank") +
        labs(title = "Physio response t-test by Section", y=col_resp,
             color = gb) + 
        theme_bw() + 
        theme(plot.title = element_text(hjust = 0.5))
    }else{
      return(df_phy_means_demands_tsecs)
    }
}
```

```{r}
section_res(df_Learning, "TaskDemand", "cue_i_on_zyg_zvalues", 
            trial_sections, plot=TRUE)
section_res(df_Learning, "TaskDemand", "cue_i_on_cor_zvalues", 
            trial_sections, plot=TRUE)
section_res(df_Learning, "TaskDemand", "cue_i_on_scr_zvalues", 
            trial_sections, plot=TRUE)
section_res(df_Learning, "TaskDemand", "cue_e_on_zyg_zvalues", 
            trial_sections, plot=TRUE)
section_res(df_Learning, "TaskDemand", "cue_e_on_cor_zvalues", 
            trial_sections, plot=TRUE)
section_res(df_Learning, "TaskDemand", "cue_e_on_scr_zvalues", 
            trial_sections, plot=TRUE)
```

```{r}
t_femg_set <- 
  df_femg_means_demands_tsecs %>% 
  group_by(Section) %>% 
  t_test(femg_z_mean ~ TaskDemand, paired = TRUE, detailed = TRUE) %>% 
  add_significance() %>% 
  add_xy_position(x = "Section")
```

boxplots
```{r}
df_femg_means_demands_tsecs %>% 
  ggplot(aes(x = Section, y = femg_z_mean,color = TaskDemand)) + 
  geom_boxplot(position = "dodge2", 
               alpha = 0.7, width = 0.5, outlier.color = "black") +
  geom_point(position = position_dodge(width = 0.5), alpha = 0.5) +
  scale_color_lancet() +
  # scale_fill_lancet() +
  # stat_summary(fun = mean, geom = "point", shape = 17, color = "black", size = 2) +
  # stat_compare_means(label = "p.signif", paired = TRUE, hide.ns = FALSE, label.y = 2.2) + 
  stat_pvalue_manual(t_femg_set, label = "p = {p}{p.signif}", hide.ns = FALSE,
                      tip.length = 0, linetype = "blank") +
  labs(title = "Physio response t-test by Section",
       color = "TaskDemand") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))
```



line plot
```{r}
df_phy_means_demands_tsecs <- 
  section_res(df_Learning, "TaskDemand", "cue_i_on_zyg_zvalues", 
            trial_sections)
df_phy_grandmeans_demands_tsecs <-
      df_phy_means_demands_tsecs %>% 
      group_by(Section, Demand) %>% 
      summarise(femg_z_gmean = mean(femg_z_mean, na.rm = TRUE), .groups = "drop") 
# Plot
df_ra_grandmeans_demands_tsecs_v2 %>% 
  ggplot(aes(x = Section, y = OnlineRatingZ_gmean, 
             group = TaskDemand, color = TaskDemand)) +
  geom_point() +
  geom_line() +
  scale_y_continuous(limits = c(-0.7, 0.7)) + 
  scale_color_lancet() +
  stat_pvalue_manual(t_ra_set_v2, label = "p = {p}{p.signif}", hide.ns = FALSE,
                     y.position = c(0.36, 0.28, 0.26, 0.34, 0.29),
                      tip.length = 0, linetype = "blank") +
  labs(title = "Ratings by Trial Sections", x = "Trial Section", y = "GrandMean (z-scored)",
       color = "Task Demand") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5),
        axis.text.x = element_text(size = 5))
```



line plot of each participant
```{r}
df_ra_means_diffs_10ts_v2 <-
  df_ra_means_demands_tsecs_v2 %>% 
  group_by(PID) %>% 
  pivot_wider(names_from = TaskDemand, values_from = OnlineRatingZ_mean,
              names_glue = "OnlineRatingZ_mean_{TaskDemand}") %>% 
  group_by(PID, Section) %>%   
  summarise(OnlineRatingZ_diff = OnlineRatingZ_mean_easy - OnlineRatingZ_mean_hard,
              .groups = "drop")

# grand mean of participants
df_ra_grandmeans_diffs_10ts_v2 <- 
  df_ra_means_diffs_10ts_v2 %>% 
  group_by(Section) %>% 
  summarise(OnlineRatingZ_diff = mean(OnlineRatingZ_diff, na.rm = TRUE),
            .groups = "drop")

# wide dataframe of each 
df_ra_means_diffs_10ts_v2_wide <- 
  df_ra_means_diffs_10ts_v2 %>% 
  pivot_wider(names_from = Section, values_from = OnlineRatingZ_diff, names_prefix = "OnlineRatingZ_diff_")
```


```{r}
df_ra_grandmeans_diffs_10ts_v2 %>% 
  mutate(TrialSection = as.numeric(Section)) %>% 
  ggplot(aes(x = TrialSection, y = OnlineRatingZ_diff)) +
  geom_point()+
  geom_line()+
  labs(title = "Rating_Diffs by Trial sections", x = "Trial Section", y = "Rating_Diff (z-scored)") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5),
        axis.text.x = element_text(size = 5))
```




## Offline Ratings
### Rating ~ Task Demand
```{r}
df_off_ra_means_de <- 
  df_Offlines %>% 
  group_by(PID, OfflineRatingTimePoint, TrialDemand) %>% 
  summarise(OfflineRating_z = mean(OfflineRating_z, na.rm=TRUE), .groups = "drop")
```

```{r}
df_off_ra_means_de_diff <- 
  df_off_ra_means_de %>% 
  pivot_wider(names_from = TrialDemand, values_from = OfflineRating_z,
              names_glue = "OfflineRating_z_{TrialDemand}") %>% 
  mutate(OfflineRating_z_diff = OfflineRating_z_Hard - OfflineRating_z_Easy) %>% 
  mutate(DemandAversive_off = ifelse(OfflineRating_z_diff < 0, "demand_aversive", "no_demand_aversive"))
```

```{r}
df_off_ra_means_de_diff_trial <- 
  df_off_ra_means_de_diff %>% 
  pivot_wider(names_from = OfflineRatingTimePoint, 
              values_from = c(OfflineRating_z_Easy,
                              OfflineRating_z_Hard,
                              OfflineRating_z_diff,
                              DemandAversive_off),
              names_glue = "{.value}_{OfflineRatingTimePoint}")
```


### boxplot
```{r}
t_off_ra_de <- 
  df_off_ra_means_de %>% 
  group_by(OfflineRatingTimePoint) %>% 
  t_test(OfflineRating_z ~ TrialDemand, paired = TRUE, detailed = TRUE) %>% 
  add_significance() %>% 
  add_xy_position(x = "OfflineRatingTimePoint")
df_off_ra_means_de %>% 
  ggplot(aes(x = OfflineRatingTimePoint, y = OfflineRating_z, color = TrialDemand)) +
  geom_boxplot(width = 0.5, position = position_dodge(width = 0.8)) +
  stat_boxplot(geom = "errorbar", width = 0.15, position = position_dodge(width = 0.8)) +
  geom_jitter(position = position_dodge2(width = 0.8), alpha = 0.7) +
  stat_pvalue_manual(t_off_ra_de, label = "p.signif", hide.ns = FALSE,
                     y.position = 3.5) + 
  scale_color_lancet() + 
  scale_y_continuous(limits = c(-5, 5)) +
  labs(title = "Offline Rating T-test on Task Demand", x = "Time Point", color = "Task Demand") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))
```



```{r}
extremes_pids <- 
  df_off_ra_means_de %>% 
  group_by(OfflineRatingTimePoint, TrialDemand) %>% 
  filter(OfflineRating_z == min(OfflineRating_z) | OfflineRating_z == max(OfflineRating_z))
# PID 114 extreme offline ratings.
```


### compare offline diff of diff in Timepoints
```{r}
t_off_ra_diff_time <- 
  df_off_ra_means_de_diff %>% 
  t_test(OfflineRating_z_diff ~ OfflineRatingTimePoint,
                  paired = TRUE, p.adjust.method = "bonferroni") %>% 
  add_significance() %>% 
  add_xy_position(x="OfflineRatingTimePoint")

df_off_ra_means_de_diff %>% 
  ggplot(aes(x = OfflineRatingTimePoint, y = OfflineRating_z_diff,
             color = OfflineRatingTimePoint)) +
  geom_boxplot(width = 0.5, position = position_dodge(width = 0.5)) +
  stat_boxplot(geom = "errorbar", width = 0.15, position = position_dodge(width = 0.5)) +
  geom_jitter(position = position_dodge2(width = 0.5), alpha = 0.7) +
  stat_summary(fun = mean, geom = "point", 
                 shape = 17, color = "black", size = 2) +
  stat_pvalue_manual(t_off_ra_diff_time, step.increase = 0.15,
                     label = "p = {p.adj}{p.adj.signif}", hide.ns = FALSE,
                     # y.position = c(8.2, 9.2, 10.5)
                     ) +
  scale_color_lancet() + 
  scale_y_continuous(limits = c(-5, 11)) +
  labs(title = "Offline Rating Diff (Hard - Easy) T-test on Time Points", 
       x = "Time Point") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))
```


### fEMG
```{r}
df_off_phy_diffs <- indi_means_comp(df_Offlines,
                                   c("cue_i_off_zyg_zvalues",
                                     "cue_i_off_cor_zvalues",
                                     "cue_i_off_scr_zvalues"),
                                   c("PID","TrialDemand"),
                                   "TrialDemand") 
```


```{r}
df_Offlines %>% group_by(OfflineRatingTimePoint) %>%
  t_test(cue_i_off_zyg_zvalues ~ TrialDemand, detailed = TRUE)

df_Offlines %>% group_by(OfflineRatingTimePoint) %>%
  t_test(cue_i_off_cor_zvalues ~ TrialDemand, detailed = TRUE)

df_Offlines %>% group_by(OfflineRatingTimePoint) %>%
  t_test(cue_i_off_scr_zvalues ~ TrialDemand, detailed = TRUE)
# too many outliers of scr
```



## True Choice
### Descriptive
```{r}
df_True_Choice <- 
  df_True_Choice %>% 
  mutate(ChoiceDemand_code = ifelse(ChoiceDemand == "Easy", 1, 0))
```

```{r}
df_true_dc_props_easy <- 
  df_True_Choice %>% 
  group_by(PID) %>% 
  summarise(DEC_prop_true = mean(ChoiceDemand_code, na.rm=TRUE), .groups = "drop") %>% 
  mutate(DemandAvoidance_true = ifelse(DEC_prop_true > 0.5, "demand_avoid", "no_demand_avoid"))
```

```{r}
df_true_dc_props_easy %>% 
  ggplot(aes(x=DEC_prop_true, fill=DemandAvoidance_true))+
  geom_histogram(alpha=0.6)+
  scale_fill_npg()
```

```{r}
table(df_true_dc_props_easy$DemandAvoidance_true)
```

9 participants' easy choice rates < 0.5 (no demand avoidance)
```{r}
# ggplot(df_true_dc_props_easy, aes(x="", y = DCERs_true, label=PID)) +
df_true_dc_props_easy %>% 
  # group_by(DemandAversive) %>% 
  # ggplot(data = ., aes(x=DemandAversive_on, y = DEC_prop_true)) +
  ggplot(data = ., aes(x="", y = DEC_prop_true)) +
  geom_boxplot(position="identity", width = 0.4) +
  geom_point(aes(group = PID, color=DemandAvoidance_true), 
             alpha = 0.8, position = position_dodge2(width = 0.15)) +
  geom_hline(aes(yintercept = 0.5, linetype = "Chance Level") ,color = "red") + 
  geom_hline(aes(yintercept = mean(DEC_prop_true, na.rm = TRUE), linetype = "Mean") ,color = "blue") + 
  scale_linetype_manual(name = "Lines", values = c(2, 2), 
                      guide = guide_legend(override.aes = list(color = c("red", "blue"))))+
  stat_boxplot(geom = "errorbar", width = 0.15) + 
  scale_y_continuous(limits = c(0, 1), n.breaks = 10) +
  # geom_text_repel(aes(color=DemandAvoidance_true), max.overlaps = nrow(df_true_dc_props_easy)) +
  scale_color_d3()+
  labs(title = "Easy Choice Probability in True Choice Phase", 
       x="DemandAversive", 
       # x="", 
       y = "P(Easy Choice)") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5),
        axis.text.x = element_text(size = 5))
```



```{r}
w_prop_true <- 
  df_true_dc_props_easy %>% 
  wilcox_test(DEC_prop_true ~ 1, mu=.5, alternative = "greater", detailed = TRUE) %>% 
  add_significance()
```

group by DemandAversive
```{r}
w_prop_true_by_aversive_on <- 
  df_true_dc_props_easy %>% 
  group_by(DemandAversive_on) %>% 
  wilcox_test(DEC_prop_true ~ 1, mu=.5, alternative = "greater", detailed = TRUE) %>% 
  add_significance()
# significantly > 0.5 among aversive group
```


### Choice Curves
All
```{r}
df_true_dc_props_easy_by_trial <- 
  df_True_Choice %>%
  group_by(PID) %>% 
  mutate(DEC_prop_true = cummean(ChoiceDemand_code)) %>% 
  mutate(DemandAvoidance_false = ifelse(DEC_prop_true > 0.5, "demand_avoid", "no_demand_avoid"))
```

```{r}
df_true_dc_props_easy_by_trial_mean <- 
  df_true_dc_props_easy_by_trial %>% 
  group_by(TrialN) %>% 
  summarise(DEC_prop_true_mean = mean(DEC_prop_true, na.rm = TRUE), .groups = "drop")
```

```{r}
df_true_dc_props_easy_by_trial_mean %>% 
  ggplot(aes(x=TrialN, y=DEC_prop_true_mean))+
  geom_line(linewidth = 0.7)+
  geom_point(shape=17)+
  # scale_color_d3()+
  geom_hline(aes(yintercept = 0.5, linetype = "Chance Level") ,color = "red")+
  geom_hline(aes(yintercept = mean(DEC_prop_true_mean, na.rm = TRUE), 
                 linetype = "Mean across TrialN"),color = "blue")+
  scale_linetype_manual(name = "Lines", values = c(2, 2), 
                      guide = guide_legend(override.aes = list(color = c("red", "blue"))))+
  geom_boxplot(data=df_true_dc_props_easy_by_trial, 
               aes(x=TrialN, y=DEC_prop_true, group = TrialN), 
               width = 0.35, outlier.shape = 8, alpha = 0.3)+
  geom_point(data=df_true_dc_props_easy_by_trial, 
               aes(x=TrialN, y=DEC_prop_true, group = TrialN,
                   color = ChoiceDemand), 
               position = position_dodge2(width = 0.35), alpha = 0.3)+
  scale_color_lancet() + 
  stat_boxplot(data=df_true_dc_props_easy_by_trial, 
               aes(x=TrialN, y=DEC_prop_true, group = TrialN),
               geom = "errorbar", width = 0.15) + 
  scale_x_continuous(limits = c(0, 11), n.breaks = 10, expand = c(0,0))+
  scale_y_continuous(limits = c(0, 1), n.breaks = 10)+
  labs(title = "Easy Choice Probability in True Choice Phase", x="TrialN", y = "P(Easy Choice)")+
  theme_bw()+
  theme(plot.title = element_text(hjust = 0.5),
        axis.text.x = element_text(size = 5))
```


```{r}
df_true_dc_props_easy_by_trial_mean %>% 
  ggplot(aes(x=TrialN, y=DEC_prop_true_mean))+
  geom_line(linewidth = 0.7)+
  geom_point()+
  geom_point(data=df_true_dc_props_easy_by_trial,
               aes(x=TrialN, y=DEC_prop_true, group = TrialN, color = factor(PID)),
               position = position_dodge2(width = 0.15), size = 0.5 ,alpha = 0.3)+
  geom_line(data=df_true_dc_props_easy_by_trial,
               aes(x=TrialN, y=DEC_prop_true, color = factor(PID)),
            linetype = "dotted", alpha = 0.5)+
  geom_hline(aes(yintercept = 0.5, linetype = "Chance Level") ,color = "red")+
  geom_hline(aes(yintercept = mean(DEC_prop_true_mean, na.rm = TRUE), 
                 linetype = "Mean across TrialN"),color = "blue")+
  scale_linetype_manual(name = "Lines", values = c(2, 2), 
                      guide = guide_legend(override.aes = list(color = c("red", "blue"))))+
  scale_x_continuous(limits = c(0, 11), n.breaks = 10, expand = c(0,0))+
  scale_y_continuous(limits = c(0, 1), n.breaks = 10)+
  labs(title = "Easy Choice Probability in True Choice Phase", x="TrialN", y = "P(Easy Choice)")+
  theme_bw()+
  theme(plot.title = element_text(hjust = 0.5),
        axis.text.x = element_text(size = 5))
```


### fEMG (CAREFUL! most trials are Easy?)
```{r}
indi_box_plot(df_True_Choice, "cue_e_true_zyg_zvalues", "ChoiceDemand", 
              FALSE, FALSE)
indi_box_plot(df_True_Choice, "cue_e_true_cor_zvalues", "ChoiceDemand", 
              FALSE, FALSE)
indi_box_plot(df_True_Choice, "cue_e_true_scr_zvalues", "ChoiceDemand", 
              FALSE, FALSE)
```


```{r}
indi_curve_plot <- function(df_clean, indicator, gb1, gb2){
  m = max(df_clean[gb1])
  df_clean %>% 
  group_by(!!sym(gb1), !!sym(gb2)) %>% 
  summarise(phy_z = mean(!!sym(indicator), na.rm=TRUE), .groups = "drop") %>% 
  ggplot(aes(x=!!sym(gb1), y=phy_z, color=!!sym(gb2)))+
  geom_line()+
  geom_point()+
  scale_color_lancet()+
  scale_x_continuous(breaks = seq(1, m))+
  theme_bw()
}
```

```{r}
indi_curve_plot(df_True_Choice, "cue_e_true_zyg_zvalues", 
                "TrialN", "ChoiceDemand")
indi_curve_plot(df_True_Choice, "cue_e_true_cor_zvalues", 
                "TrialN", "ChoiceDemand")
indi_curve_plot(df_True_Choice, "cue_e_true_scr_zvalues", 
                "TrialN", "ChoiceDemand")
```



## False Choice
### Descriptive
```{r}
df_False_Choice <- 
  df_False_Choice %>% 
  mutate(ChoiceDemand_code = ifelse(ChoiceDemand == "Easy", 1, 0))
```

```{r}
df_false_dc_props_easy <- 
  df_False_Choice %>% 
  group_by(PID) %>% 
  summarise(DEC_prop_false = mean(ChoiceDemand_code, na.rm=TRUE), .groups = "drop") %>% 
  mutate(DemandAvoidance_false = ifelse(DEC_prop_false > 0.5, "demand_avoid", "no_demand_avoid"))
```

```{r}
# df_false_dc_props_easy$PID[df_false_dc_props_easy$DEC_prop_false==0]
```


```{r}
table(df_false_dc_props_easy$DemandAvoidance_false)
```

14/36 participants' easy choice rates < 0.5 (no demand avoidance)
```{r}
# ggplot(df_true_dc_props_easy, aes(x="", y = DCERs_true, label=PID)) +
df_false_dc_props_easy %>% 
  # group_by(DemandAversive) %>% 
  # ggplot(data = ., aes(x=DemandAversive_on, y = DEC_prop_true)) +
  ggplot(data = ., aes(x="", y = DEC_prop_false)) +
  geom_boxplot(position="identity", width = 0.4) +
  geom_point(aes(group = PID, color=DemandAvoidance_false), 
             alpha = 0.8, position = position_dodge2(width = 0.15)) +
  geom_hline(aes(yintercept = 0.5, linetype = "Chance Level") ,color = "red") + 
  geom_hline(aes(yintercept = mean(DEC_prop_false, na.rm = TRUE), linetype = "Mean") ,color = "blue") + 
  scale_linetype_manual(name = "Lines", values = c(2, 2), 
                      guide = guide_legend(override.aes = list(color = c("red", "blue"))))+
  stat_boxplot(geom = "errorbar", width = 0.15) + 
  scale_y_continuous(limits = c(0, 1), n.breaks = 10) +
  # geom_text_repel(aes(color=DemandAvoidance_true), max.overlaps = nrow(df_true_dc_props_easy)) +
  scale_color_d3()+
  labs(title = "Easy Choice Probability in False Choice Phase", 
       x="DemandAversive", 
       # x="", 
       y = "P(Easy Choice)") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5),
        axis.text.x = element_text(size = 5))
```


```{r}
df_false_dc_props_easy_10 <- 
  df_False_Choice %>% 
  filter(TrialN %in% c(1:10)) %>% 
  group_by(PID) %>% 
  summarise(DEC_prop_false = mean(ChoiceDemand_code, na.rm=TRUE), .groups = "drop") %>% 
  mutate(DemandAvoidance_false = ifelse(DEC_prop_false > 0.5, "demand_avoid", "no_demand_avoid"))

table(df_false_dc_props_easy_10$DemandAvoidance_false)
```
```{r}
df_false_dc_props_easy_50 <- 
  df_False_Choice %>% 
  filter(TrialN %in% c(41:50)) %>% 
  group_by(PID) %>% 
  summarise(DEC_prop_false = mean(ChoiceDemand_code, na.rm=TRUE), .groups = "drop") %>% 
  mutate(DemandAvoidance_false = ifelse(DEC_prop_false > 0.5, "demand_avoid", "no_demand_avoid"))

table(df_false_dc_props_easy_50$DemandAvoidance_false)
```



```{r}
w_prop_false_ <- 
  df_false_dc_props_easy %>% 
  wilcox_test(DEC_prop_false ~ 1, mu=.5, alternative = "greater", detailed = TRUE) %>% 
  add_significance()
```


### False Choice Learning Curve
Accumulated proportion by trialN
```{r}
df_false_dc_props_easy_by_trial <- 
  df_False_Choice %>%
  group_by(PID) %>% 
  mutate(DEC_prop_false = cummean(ChoiceDemand_code)) %>% 
  mutate(DemandAvoidance_false = ifelse(DEC_prop_false > 0.5, "demand_avoid", "no_demand_avoid"))
```

```{r}
df_false_dc_props_easy_by_trial_mean <- 
  df_false_dc_props_easy_by_trial %>% 
  group_by(TrialN) %>% 
  summarise(DEC_prop_false_mean = mean(DEC_prop_false, na.rm = TRUE), .groups = "drop")
```

```{r}
df_false_dc_props_easy_by_trial_mean %>% 
  ggplot(aes(x=TrialN, y=DEC_prop_false_mean))+
  geom_line(linewidth=0.7)+
  geom_point(shape=17)+
  geom_boxplot(data=df_false_dc_props_easy_by_trial,
               aes(x=TrialN, y=DEC_prop_false, group = TrialN),
               width = 0.35, outlier.shape = 8, alpha = 0.3)+
  geom_point(data=df_false_dc_props_easy_by_trial,
               aes(x=TrialN, y=DEC_prop_false, group = TrialN),
               position = position_dodge2(width = 0.15), size = 0.5 ,alpha = 0.3)+
  geom_line(data=df_false_dc_props_easy_by_trial,
               aes(x=TrialN, y=DEC_prop_false, color = ChoiceDemand),
            linetype = "dotted")+
  stat_boxplot(data=df_false_dc_props_easy_by_trial,
               aes(x=TrialN, y=DEC_prop_false, group = TrialN),
               geom = "errorbar", width = 0.15) +
  geom_hline(aes(yintercept = 0.5, linetype = "Chance Level"), 
             color = "red", linewidth = 0.7)+
  geom_hline(aes(yintercept = mean(DEC_prop_false_mean, na.rm = TRUE), linetype = "Mean across TrialN"),
             color = "blue", linewidth = 0.7)+
  scale_linetype_manual(name = "Lines", values = c(2, 2), 
                      guide = guide_legend(override.aes = list(color = c("red", "blue"))))+
  scale_color_lancet()+
  scale_x_continuous(limits = c(0, 51), n.breaks = 50, expand = c(0,0))+
  scale_y_continuous(limits = c(0, 1), n.breaks = 10)+
  labs(title = "Easy Choice Probability in False Choice Phase", x="TrialN", y = "P(Easy Choice)")+
  theme_bw()+
  theme(plot.title = element_text(hjust = 0.5),
        axis.text.x = element_text(size = 5))
```

group by Demand Aversive
```{r}
df_false_dc_props_easy_by_trial_mean_by_aversive <- 
  df_false_dc_props_easy_by_trial %>% 
  group_by(TrialN, DemandAversive) %>% 
  summarise(DEC_prop_false_mean = mean(DEC_prop_false, na.rm = TRUE), .groups = "drop")
```

```{r}
df_false_dc_props_easy_by_trial_mean_by_aversive %>% 
  ggplot(aes(x=TrialN, y=DEC_prop_false_mean, group = DemandAversive))+
  geom_hline(aes(yintercept = 0.5, linetype = "Chance Level"), 
             color = "red", linewidth = 0.7)+
  geom_hline(aes(yintercept = mean(DEC_prop_false_mean[DemandAversive == "demand_aversive"], na.rm = TRUE), 
                 linetype = "Mean-Aversive"), # Mean across TrialN of Aversive group
             color = "blue", linewidth = 0.7)+
  geom_hline(aes(yintercept = mean(DEC_prop_false_mean[DemandAversive == "no_demand_aversive"], na.rm = TRUE), 
                 linetype = "Mean-No-Aversive"), #Mean across TrialN of No-Aversive group
             color = "orange", linewidth = 0.7)+
  scale_linetype_manual(name = "Lines", values = c(2, 2, 2), 
                      guide = guide_legend(override.aes = list(color = c("red", "blue", "orange"))))+
  geom_boxplot(data=df_false_dc_props_easy_by_trial_v2,
               aes(x=TrialN, y=DEC_prop_false, group = TrialN),
               width = 0.35, outlier.shape = 8, alpha = 0.3)+
  geom_point(data=df_false_dc_props_easy_by_trial_v2,
               aes(x=TrialN, y=DEC_prop_false, group = TrialN, color = ChoiceDemand),
               position = position_dodge2(width = 0.15), size = 0.5 ,alpha = 0.3)+
  # geom_line(data=df_false_dc_props_easy_by_trial_v2,
  #              aes(x=TrialN, y=DEC_prop_false),
  #           linetype = "dotted")+
  stat_boxplot(data=df_false_dc_props_easy_by_trial_v2,
               aes(x=TrialN, y=DEC_prop_false, group = TrialN),
               geom = "errorbar", width = 0.15) +
  geom_line(linewidth=0.7)+
  geom_point(shape=17)+
  scale_color_lancet()+
  facet_wrap(~DemandAversive)+
  scale_x_continuous(limits = c(0, 51), n.breaks = 50, expand = c(0,0))+
  scale_y_continuous(limits = c(0, 1), n.breaks = 10)+
  labs(title = "Easy Choice Probability in False Choice Phase", x="TrialN", y = "P(Easy Choice)")+
  theme_bw()+
  theme(plot.title = element_text(hjust = 0.5),
        axis.text.x = element_text(size = 5))
```


each participant
```{r}
df_false_dc_props_easy_by_trial_v2_mean_by_aversive %>% 
  ggplot(aes(x=TrialN, y=DEC_prop_false_mean))+
  geom_boxplot(data=df_false_dc_props_easy_by_trial_v2,
               aes(x=TrialN, y=DEC_prop_false, group = TrialN),
               width = 0.35, outlier.shape = 8, alpha = 0.3)+
  geom_point(data=df_false_dc_props_easy_by_trial_v2,
               aes(x=TrialN, y=DEC_prop_false, group = TrialN),
               position = position_dodge2(width = 0.15), size = 0.5 ,alpha = 0.3)+
  geom_line(data=df_false_dc_props_easy_by_trial_v2,
               aes(x=TrialN, y=DEC_prop_false, color = factor(PID)),
            linetype = "dotted")+
  stat_boxplot(data=df_false_dc_props_easy_by_trial_v2,
               aes(x=TrialN, y=DEC_prop_false, group = TrialN),
               geom = "errorbar", width = 0.15) +
  geom_line(linewidth=0.7)+
  geom_point(shape=17)+
  geom_hline(aes(yintercept = 0.5, linetype = "Chance Level"), 
             color = "red", linewidth = 0.7)+
  geom_hline(aes(yintercept = mean(DEC_prop_false_mean, na.rm = TRUE), linetype = "Mean across TrialN"),
             color = "blue", linewidth = 0.7)+
  scale_linetype_manual(name = "Lines", values = c(2, 2), 
                      guide = guide_legend(override.aes = list(color = c("red", "blue"))))+
  facet_wrap(~DemandAversive)+
  scale_x_continuous(limits = c(0, 51), n.breaks = 50, expand = c(0,0))+
  scale_y_continuous(limits = c(0, 1), n.breaks = 10)+
  labs(title = "Easy Choice Probability in False Choice Phase", x="TrialN", y = "P(Easy Choice)")+
  theme_bw()+
  theme(plot.title = element_text(hjust = 0.5),
        axis.text.x = element_text(size = 5))
```




#### Separate Proportions by sections (10 trials) 
```{r}
# review the number of easy and hard trials in each trial section
# it turns out to be relatively balanced
result_table <- 
  df_Flase_Choice %>%
  mutate(Trial_N_Group = cut(TrialN, breaks = c(1, 10, 20, 30, 40, 50), labels = FALSE)) %>%
  # mutate(Trial_N_Group = cut(TrialN, breaks = c(1,5,10,15,20,25,30,35,40,45,50), labels = FALSE)) %>%
  group_by(PID, Trial_N_Group) %>%
  summarise(DEC_prop_false = mean(ChoiceDemand_code, na.ra = TRUE), .groups = "drop")

# Print the resulting table
# print(result_table)

```


```{r}
section_DEC_res <- function(df_clean, gb, col_resp, sections, plot=FALSE){
  # Create a function to calculate mean for each section of trials
  section_means <- function(df_clean, col_resp, section){
    df <- 
      df_clean %>%
        group_by(PID) %>%
        summarise(across((col_resp),
                         ~ mean(.[TrialN %in% section], na.rm = TRUE),
                         .names = "indi_mean"), .groups = "drop")
  }
  # Initialize an empty list to store the results
  result_list <- list()
  
  # Use lapply to iterate over each section and calculate means
  result_list <- lapply(names(sections), function(section_name) {
    section <- trial_sections[[section_name]]
    
    # Calculate means for the current section
    result <- section_means(df_clean, col_resp, section)
    
    # Add a column indicating the section name
    result$Section <- section_name
    
    return(result)
    })
    # Combine the results into a single data frame
    df_indi_means_demands_tsecs <- bind_rows(result_list)

    
    if(plot){
      df_indi_means_demands_tsecs %>% 
        ggplot(aes(x = Section, y = indi_mean)) + 
        geom_boxplot(position = "dodge2", 
                     alpha = 0.7, width = 0.5, outlier.color = "black") +
        geom_jitter(position = position_dodge(width = 0.75), alpha = 0.5) +
        scale_color_lancet() +
        stat_summary(fun = mean, geom = "point", aes(group = Section),
                 shape = 17, color="black", size = 2,
               position = position_dodge(width = 0.5)) +
        # stat_pvalue_manual(t_indi_set, label = "p = {p}{p.signif}", hide.ns = FALSE,
        #                     tip.length = 0, linetype = "blank") +
        labs(title = "DEC by Section", y=col_resp) + 
        theme_bw() + 
        theme(plot.title = element_text(hjust = 0.5))
    }else{
      return(df_indi_means_demands_tsecs)
    }
}
```

```{r}
section_DEC_res(df_False_Choice, NA,"ChoiceDemand_code",
            trial_sections, plot=TRUE)


```



#### lines plot of false choice rates in easy and hard demands
```{r}
# Create a function to calculate mean for each section of trials
calculate_section_means <- function(df, col_reps, section, gb=NA) {
  if(!is.na(gb)){
    df %>%
    group_by(PID, !!sym(gb)) %>%
    summarise(across(starts_with(col_reps),
                     ~ mean(.[TrialN %in% section], na.rm = TRUE),
                     .names = "indi_mean"), .groups = "drop")
  }else{
    df %>%
    group_by(PID) %>%
    summarise(across(starts_with(col_reps),
                     ~ mean(.[TrialN %in% section], na.rm = TRUE),
                     .names = "indi_mean"), .groups = "drop")
  }
}

# Define the sections
trial_sections <- list("10" = 1:10, "20" = 11:20, "30" = 21:30, "40" = 31:40, "50" = 41:50)
# trial_sections <- list("05" = 1:5, "10" = 6:10,
#                        "15" = 11:15, "20" = 16:20,
#                        "25" = 21:25, "30" = 26:30,
#                        "35" = 31:35, "40" = 36:40,
#                        "45" = 41:45, "50" = 46:50)

# Initialize an empty list to store the results
result_list <- list()
# Use lapply to iterate over each section and calculate means
result_list <- function(df,trial_sections, indicator, gb=NA){
  lapply(names(trial_sections), function(section_name) {
  section <- trial_sections[[section_name]]
  
  # Calculate means for the current section
  result <- calculate_section_means(df, indicator, section, gb)
  
  # Add a column indicating the section name
  result$Section <- section_name
  
  return(result)
})
  }
```


```{r}
# Combine the results into a single data frame
df_false_dc_prop_means_de_sec <- 
  bind_rows(result_list(df_False_Choice,trial_sections ,"ChoiceDemand_code")) %>% 
  mutate(DemandAvoidance_false = ifelse(indi_mean > 0.5, "demand_avoid", "no_demand_avoid")) %>% 
  merge(df_off_ra_means_de_diff[df_off_ra_means_de_diff$OfflineRatingTimePoint=="T2", c("PID", "DemandAversive_off")], by = "PID", all.x = T)
```


```{r}
df_false_dc_prop_grandmeans_de_sec <-
  df_false_dc_prop_means_de_sec %>% 
  group_by(Section) %>% 
  summarise(indi_gmean = mean(indi_mean, na.rm = TRUE), .groups = "drop") 
```

points in different colors of each participant
```{r}
df_false_dc_prop_means_de_sec %>% 
  ggplot(aes(x = Section, y = indi_mean))+
  geom_boxplot(position = position_dodge(width = 0.5))+
  stat_boxplot(geom = "errorbar", width = 0.15) +
  geom_jitter(
    aes(color = factor(PID)),
    position = position_dodge(width = 0.35), alpha = 0.5)+
  stat_summary(fun = "mean", shape = 17)+
  labs(title = "Easy Choice Probability in False Choice Phase", 
       x="Trial Section", y = "P (Easy Choice)", color = "PID") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5),
        axis.text.x = element_text(size = 5))
```


grand means of participants in each trial section
```{r}
df_false_dc_prop_grandmeans_de_sec %>% 
  mutate(TrialSection = as.numeric(Section)) %>%
  ggplot(aes(x = TrialSection, y = indi_gmean)) +
  geom_point() +
  geom_line() +
  geom_hline(aes(yintercept = 0.5, linetype = "Chance Level"), color = "red") +
  geom_hline(aes(yintercept = mean(df_false_dc_prop_means_de_sec$indi_mean, na.rm = TRUE), 
             linetype = "Mean"), color = "blue") +
        geom_point(position = position_dodge(width = 0.5), alpha = 0.5) +
        scale_color_lancet() +
        stat_summary(fun = mean, geom = "point", 
                 shape = 17, color="black", size = 2,
               position = position_dodge(width = 0.5)) +
  # scale_x_continuous(breaks = c(5,10,15,20,25,30,35,40,45,50))+
  
  scale_x_continuous(breaks = c(10,20,30,40,50))+
  scale_y_continuous(limits = c(0, 1), n.breaks = 10)+
  labs(title = "Easy Choice Probability by Trial Sections in False Choice Phase", 
       x = "Trial Section", y = "Easy Choice Probability (grandmean)") +
  scale_linetype_manual(name = "Lines", values = c(2, 2), 
                      guide = guide_legend(override.aes = list(color = c("red", "blue"))))+
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5),
        axis.text.x = element_text(size = 5))
```


The first 10 trials
```{r}
df_false_dc_means_demands_tsecs_v2 %>% 
  filter(Section == 10) %>% 
  ggplot(aes(x="", y=DEC_prop_false))+
  geom_boxplot(position="identity", width = 0.4)+
  geom_point(position = position_dodge2(width = 0.15), aes(color = DemandAvoidance_false))+
  stat_boxplot(geom = "errorbar", width = 0.15)+
  scale_color_d3()+
  geom_hline(aes(yintercept = 0.5, linetype = "Chance Level"),color = "red")+
  geom_hline(aes(yintercept = mean(DEC_prop_false, na.rm = TRUE), 
                 linetype = "Mean") ,color = "blue")+
  scale_linetype_manual(name = "Lines", values = c(2, 2), 
                      guide = guide_legend(override.aes = list(color = c("red", "blue"))))+
  scale_y_continuous(limits = c(0, 1), n.breaks = 10)+
  labs(title = "Easy Choice Probability in False Choice Phase 1-10 Trials", x="", y = "P(Easy Choice)")+
  theme_bw()+
  theme(plot.title = element_text(hjust = 0.5),
        axis.text.x = element_text(size = 5))
```

Identify participants without exploration in first 10 trials
```{r}
no_explore_pid <- 
  df_false_dc_means_demands_tsecs_v2 %>% 
  filter(PID %in% PID[Section == 10 & DEC_prop_false == 1]) %>% 
  dplyr::select(PID)
no_explore_pid <- unique(as.numeric(no_explore_pid$PID))

df_false_dc_means_demands_tsecs_v2_explored <-  
  df_false_dc_means_demands_tsecs_v2 %>% 
  filter(!PID %in% no_explore_pid)
  
df_false_dc_grandmeans_demands_tsecs_v2_explored <-
  df_false_dc_means_demands_tsecs_v2_explored %>%
  group_by(Section) %>% 
  summarise(DEC_prop_false_gmean = mean(DEC_prop_false, na.rm = TRUE), .groups = "drop") 
```

```{r}
# Plot
df_false_dc_grandmeans_demands_tsecs_v2_explored %>% 
  mutate(TrialSection = as.numeric(Section)) %>%
  ggplot(aes(x = TrialSection, y = DEC_prop_false_gmean)) +
  geom_point() +
  geom_line() +
  geom_hline(aes(yintercept = 0.5, linetype = "Chance Level"), color = "red") +
  geom_hline(aes(yintercept = mean(df_false_dc_means_demands_tsecs_v2_explored$DEC_prop_false, na.rm = TRUE),
             linetype = "Mean across TrialN"), color = "blue") +
  # scale_x_continuous(breaks = c(5,10,15,20,25,30,35,40,45,50))+
  scale_x_continuous(breaks = c(10,20,30,40,50))+
  # scale_y_continuous(limits = c(0, 1), n.breaks = 10)+
  labs(title = "\n Easy Choice Probability by Trial Sections in False Choice Phase \n
       (exclude participants without exploration in 1st section)", 
       x = "Trial Section", y = "Easy Choice Probability (grandmean)") +
  scale_linetype_manual(name = "Lines", values = c(2, 2), 
                      guide = guide_legend(override.aes = list(color = c("red", "blue"))))+
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5),
        axis.text.x = element_text(size = 5))
```


group by Demand Aversive
```{r}
df_false_dc_grandmeans_demands_tsecs_v2_by_aversive_on <-
  df_false_dc_means_demands_tsecs_v2 %>% 
  group_by(Section, DemandAversive_on) %>% 
  summarise(DEC_prop_false_gmean = mean(DEC_prop_false, na.rm = TRUE), .groups = "drop") 
```

```{r}
df_false_dc_grandmeans_demands_tsecs_v2_by_aversive %>% 
  mutate(TrialSection = as.numeric(Section)) %>%
  ggplot(aes(x = TrialSection, y = DEC_prop_false_gmean)) +
  geom_point() +
  geom_line() +
  geom_hline(aes(yintercept = 0.5, linetype = "Chance Level"), color = "red") +
  geom_hline(aes(yintercept = mean(DEC_prop_false_gmean[DemandAversive == "demand_aversive"], na.rm = TRUE), 
             linetype = "Mean-Aversive"), color = "blue") +
  geom_hline(aes(yintercept = mean(DEC_prop_false_gmean[DemandAversive == "no_demand_aversive"], na.rm = TRUE), 
             linetype = "Mean-No-Aversive"), color = "orange") +
  # scale_x_continuous(breaks = c(5,10,15,20,25,30,35,40,45,50))+
  scale_x_continuous(breaks = c(10,20,30,40,50))+
  scale_y_continuous(limits = c(0, 1), n.breaks = 10)+
  labs(title = "Easy Choice Probability by Trial Sections in False Choice Phase", 
       x = "Trial Section", y = "Easy Choice Probability (grandmean)") +
  scale_linetype_manual(name = "Lines", values = c(2, 2, 2), 
                      guide = guide_legend(override.aes = list(color = c("red", "blue", "orange"))))+
  facet_wrap(~DemandAversive)+
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5),
        axis.text.x = element_text(size = 5))
```


### fEMG
```{r}
indi_hist_plot(df_False_Choice, "cue_e_false_zyg_zvalues", "ChoiceDemand")
indi_hist_plot(df_False_Choice, "cue_e_false_cor_zvalues", "ChoiceDemand")
indi_hist_plot(df_False_Choice, "cue_e_false_scr_zvalues", "ChoiceDemand")
```


```{r}
indi_box_plot(df_False_Choice, "cue_e_false_zyg_zvalues", "ChoiceDemand", 
              FALSE, FALSE)
indi_box_plot(df_False_Choice, "cue_e_false_cor_zvalues", "ChoiceDemand", 
              FALSE, FALSE)
indi_box_plot(df_False_Choice, "cue_e_false_scr_zvalues", "ChoiceDemand", 
              FALSE, FALSE)
```


```{r}
# Combine the results into a single data frame
df_false_phy_means_de_sec <- 
  bind_rows(result_list(df = df_False_Choice,trial_sections,
                       "cue_e_false_zyg_zvalues", "ChoiceDemand")) %>% 
  merge(df_off_ra_means_de_diff[df_off_ra_means_de_diff$OfflineRatingTimePoint=="T2", c("PID", "DemandAversive_off")], by = "PID", all.x = T)
df_false_phy_means_de_sec %>% 
  ggplot(aes(x = Section, y=indi_mean, 
             color  = ChoiceDemand, fill = ChoiceDemand)) +
  geom_boxplot(alpha=0.5)+
  # scale_x_continuous(breaks = seq(-5, 5)) +
  stat_summary(fun = mean, geom = "point", 
                 shape = 17, size = 2, color="black",
               position = position_dodge(width = 0.75)) +
  scale_color_lancet() + 
  scale_fill_lancet() + 
  labs(title = "physio resp mean of participants") + 
  guides(color = "none") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))
```


```{r}
df_false_phy_grandmeans_de_sec <-
  df_false_phy_means_de_sec %>% 
  group_by(Section) %>% 
  summarise(indi_gmean = mean(indi_mean, na.rm = TRUE), .groups = "drop") 
```



```{r}
# use for correlation analysis
df_false_dc_prop_means_de_sec_wide <- 
  df_false_dc_prop_means_de_sec %>% 
  dplyr::select(-DemandAvoidance_false) %>% 
  pivot_wider(names_from = Section, values_from = DEC_prop_false, names_prefix = "DEC_prop_false_") %>% 
  # mutate(DEC_prop_false_drop = DEC_prop_false_10 - DEC_prop_false_50) %>% 
  merge(df_off_ra_means_de_diff[df_off_ra_means_de_diff$OfflineRatingTimePoint=="T2", c("PID", "DemandAversive_off")], by = "PID", all.x = T)
```

```{r}
w_prop_false_sec1_v2 <- 
  df_false_dc_means_demands_tsecs_wide %>% 
  wilcox_test(DEC_prop_false_10 ~ 1, mu=.5, alternative = "greater", detailed = TRUE) %>% 
  add_significance()

w_prop_false_sec2_v2 <- 
  df_false_dc_means_demands_tsecs_wide %>% 
  wilcox_test(DEC_prop_false_20 ~ 1, mu=.5, alternative = "greater", detailed = TRUE) %>% 
  add_significance()

w_prop_false_sec3_v2 <- 
  df_false_dc_means_demands_tsecs_wide %>% 
  wilcox_test(DEC_prop_false_30 ~ 1, mu=.5, alternative = "greater", detailed = TRUE) %>% 
  add_significance()

w_prop_false_sec4_v2 <- 
  df_false_dc_means_demands_tsecs_wide %>% 
  wilcox_test(DEC_prop_false_40 ~ 1, mu=.5, alternative = "greater", detailed = TRUE) %>% 
  add_significance()

# Section 5 became non-significant
w_prop_false_sec5_v2 <- 
  df_false_dc_means_demands_tsecs_v2_wide %>% 
  wilcox_test(DEC_prop_false_50 ~ 1, mu=.5, alternative = "greater", detailed = TRUE) %>% 
  add_significance()
```



## Questionnaires
### Distribution of questionnaires data
```{r}
ques_indi_hist_plot <- function(df_clean, indicator){
  gghistogram(df_clean[[indicator]], bins = 15, fill = "lightblue")+
  geom_vline(xintercept = mean(df_clean[[indicator]], na.rm=TRUE), 
             linetype="dashed", linewidth=0.7, color="darkblue")+
  labs(title = indicator, x="score", y = "Count")+
  theme_bw()+
  theme(plot.title = element_text(hjust = 0.5),
        axis.text.x = element_text(size = 5))
}

ques_indi_summary <- function(df_clean, indicator){
  indi_summary <- 
    df_clean %>% 
    summarise(indi_mean = mean(!!sym(indicator), na.rm=TRUE),
           indi_sd = sd(!!sym(indicator), na.rm=TRUE),
           indi_med = median(!!sym(indicator), na.rm=TRUE),
           indi_min = min(!!sym(indicator), na.rm=TRUE),
           indi_max = max(!!sym(indicator), na.rm=TRUE))
  return(indi_summary)
}
```

```{r}
Qs <- list("BAI_bis","BAI_bas_d","BAI_bas_rr","BAI_bas_fs",
        "NFC",
        "BFI_ext" ,"BFI_agr","BFI_con","BFI_neu","BFI_open",
        "UPPS_lps","UPPS_lpm","UPPS_pu","UPPS_ss")
for (q in Qs){
  p <- ques_indi_hist_plot(df_clean, q)
  print(p)
  }
```





## Correlations
```{r}
df_ra_dc <- 
  merge(df_off_ra_means_de_diff, df_true_dc_props_easy, by="PID", all = TRUE) %>%
  merge(df_false_dc_props_easy, by="PID", all = TRUE) %>% 
  merge(df_false_dc_prop_means_de_sec, by="PID", all = TRUE) %>% 
  merge(df_on_phy_means_de, by="PID", all = TRUE) %>% 
  merge(df_false_phy_means_de, by="PID", all = TRUE) %>% 
  merge(df_clean, by="PID", all = TRUE)
```


```{r}
df_cors <- 
  df_ra_dc %>% 
  filter(OfflineRatingTimePoint.x=="T2") %>%
  select(OfflineRating_z_diff, cue_i_on_scr_zvalues.x)
cor(df_cors)
```

```{r}

```


correlation matrix output
```{r}
ra_dc_cors_matrix_v2 <- rcorr(as.matrix(df_cors_pure_v2))
# write.csv(ra_dc_cors_matrix_v2$r, 
#           file = "E:/Dissertation/Methods/Exp2_Demand_Choice/DARDCpy_v2/data_analysis/cors_matrix_r_v2.csv")
# write.csv(ra_dc_cors_matrix_v2[["P"]], 
#           file = "E:/Dissertation/Methods/Exp2_Demand_Choice/DARDCpy_v2/data_analysis/cors_matrix_p_v2.csv")
```

```{r}
ra_dc_cors_v2 <- cor(df_cors_pure_v2)
print(ra_dc_cors_v2)
write.csv(ra_dc_cors_v2, 
          file = "E:/Dissertation/Methods/Exp2_Demand_Choice/DARDCpy_v2/data_analysis/cors_v2.csv")


print("Online ~ True Choice")
bf <- correlationBF(df_cors_v2$OnlineRatingZs_diff, df_cors_v2$DCERs_true)
bf

print("Offline_T1 ~ True Choice")
bf <- correlationBF(df_cors_v2$OfflineRating_T1Zs_diff, df_cors_v2$DCERs_true)
bf

print("Offline_T2 ~ True Choice")
bf <- correlationBF(df_cors_v2$OfflineRating_T2Zs_diff, df_cors_v2$DCERs_true)
bf


print("Offline_T2 ~ False Choice")
bf <- correlationBF(df_cors_v2$OfflineRating_T2Zs_diff, df_cors_v2$DCERs_false)
bf

print("Offline_T3 ~ False Choice")
bf <- correlationBF(df_cors_v2$OfflineRating_T3Zs_diff, df_cors_v2$DCERs_false)
bf

# samples <- posterior(bf, iterations = 1000)
# summary(samples)
```



Scatter plots
#### Online Rating ~ Offline Rating
```{r}
# ggplot(df_cors_v2, aes(x = OnlineRatingZs_diff, y = OfflineRating_T1Zs_diff, label = PID)) +
ggplot(df_cors_v2, aes(x = OnlineRatingZs_diff, y = OfflineRating_T1Zs_diff)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: Online & Offline Rating T1", 
       x = "Online Rating Diff (easy - hard)", y = "Offline Rating T1 Diff (easy - hard)") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))


# ggplot(df_cors_v2, aes(x = OnlineRatingZs_diff, y = OfflineRating_T2Zs_diff, label = PID)) +
ggplot(df_cors_v2, aes(x = OnlineRatingZs_diff, y = OfflineRating_T2Zs_diff)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: Online & Offline Rating T2", 
       x = "Online Rating Diff (easy - hard)", y = "Offline Rating T2 Diff (easy - hard)") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))


# ggplot(df_cors_v2, aes(x = OnlineRatingZs_diff, y = OfflineRating_T2Zs_diff, label = PID)) +
ggplot(df_cors_v2, aes(x = OnlineRatingZs_diff, y = OfflineRating_T3Zs_diff)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: Online & Offline Rating T3", 
       x = "Online Rating Diff (easy - hard)", y = "Offline Rating T3 Diff (easy - hard)") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))


# ggplot(df_cors_v2, aes(x = OfflineRating_T1Zs_diff, y = OfflineRating_T2Zs_diff, label = PID)) +
ggplot(df_cors_v2, aes(x = OfflineRating_T1Zs_diff, y = OfflineRating_T2Zs_diff)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: Offline Rating T1 & T2", 
       x = "Offline Rating T1 Diff (easy - hard)", y = "Offline Rating T2 Diff (easy - hard)") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))

# ggplot(df_cors_v2, aes(x = OfflineRating_T1Zs_diff, y = OfflineRating_T2Zs_diff, label = PID)) +
ggplot(df_cors_v2, aes(x = OfflineRating_T1Zs_diff, y = OfflineRating_T3Zs_diff)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: Offline Rating T1 & T3", 
       x = "Offline Rating T1 Diff (easy - hard)", y = "Offline Rating T3 Diff (easy - hard)") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))

# ggplot(df_cors_v2, aes(x = OfflineRating_T1Zs_diff, y = OfflineRating_T2Zs_diff, label = PID)) +
ggplot(df_cors_v2, aes(x = OfflineRating_T2Zs_diff, y = OfflineRating_T3Zs_diff)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: Offline Rating T2 & T3", 
       x = "Offline Rating T2 Diff (easy - hard)", y = "Offline Rating T3 Diff (easy - hard)") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))
```

#### Online Rating ~ Choice
```{r}
# ggplot(df_cors_v2, aes(x = OnlineRatingZs_diff, y = DCERs_true, label = PID)) +
ggplot(df_cors_v2, aes(x = OnlineRatingZs_diff, y = DEC_prop_true)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: Online Rating & True Choice", 
       x = "Online Rating Diff (easy - hard)", y = "Easy Choice Proportion") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))

# ggplot(df_cors_v2, aes(x = OnlineRatingZs_diff, y = DCERs_true, label = PID)) +
ggplot(df_cors_v2, aes(x = OnlineRatingZs_diff, y = DEC_prop_false)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: Online Rating & False Choice", 
       x = "Online Rating Diff (easy - hard)", y = "Easy Choice Proportion") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))

# ggplot(df_cors_v2, aes(x = OnlineRatingZ_diff_50, y = DCERs_true, label = PID)) +
ggplot(df_cors_v2, aes(x = OnlineRatingZ_diff_50, y = DEC_prop_true)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: Online Rating in 5th Trial Section & True Choice", 
       x = "Online Rating Diff (easy - hard)", y = "Easy Choice Proportion") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))

# ggplot(df_cors_v2, aes(x = OnlineRatingZ_diff_50, y = DCERs_true, label = PID)) +
ggplot(df_cors_v2, aes(x = OnlineRatingZ_diff_50, y = DEC_prop_false)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: Online Rating in 5th Trial Section & False Choice", 
       x = "Online Rating Diff (easy - hard)", y = "Easy Choice Proportion") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))

# ggplot(df_cors_v2, aes(x = OnlineRatingZ_diff_50, y = DCERs_true, label = PID)) +
ggplot(df_cors_v2, aes(x = OnlineRatingZ_diff_50, y = DEC_prop_false_10)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: Online Rating in 5th Trial Section & False Choice 1st Trial Section", 
       x = "Online Rating Diff (easy - hard)", y = "Easy Choice Proportion") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))

# ggplot(df_cors_v2, aes(x = OnlineRatingZ_diff_50, y = DCERs_true, label = PID)) +
ggplot(df_cors_v2, aes(x = OnlineRatingZ_diff_50, y = DEC_prop_false_20)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: Online Rating in 5th Trial Section & False Choice 2nd Trial Section", 
       x = "Online Rating Diff (easy - hard)", y = "Easy Choice Proportion") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))

# ggplot(df_cors_v2, aes(x = OnlineRatingZ_diff_50, y = DCERs_true, label = PID)) +
ggplot(df_cors_v2, aes(x = OnlineRatingZ_diff_50, y = DEC_prop_false_30)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: Online Rating in 5th Trial Section & False Choice 3rd Trial Section", 
       x = "Online Rating Diff (easy - hard)", y = "Easy Choice Proportion") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))

# ggplot(df_cors_v2, aes(x = OnlineRatingZ_diff_50, y = DCERs_true, label = PID)) +
ggplot(df_cors_v2, aes(x = OnlineRatingZ_diff_50, y = DEC_prop_false_40)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: Online Rating in 5th Trial Section & False Choice 4th Trial Section", 
       x = "Online Rating Diff (easy - hard)", y = "Easy Choice Proportion") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))

# ggplot(df_cors_v2, aes(x = OnlineRatingZ_diff_50, y = DCERs_true, label = PID)) +
ggplot(df_cors_v2, aes(x = OnlineRatingZ_diff_50, y = DEC_prop_false_50)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: Online Rating in 5th Trial Section & False Choice 5th Trial Section", 
       x = "Online Rating Diff (easy - hard)", y = "Easy Choice Proportion") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))
```


#### Offline Rating ~ Choice
```{r}
# ggplot(df_cors_v2, aes(x = OfflineRating_T1Zs_diff, y = DCERs_true, label = PID)) +
ggplot(df_cors_v2, aes(x = OfflineRating_T1Zs_diff, y = DEC_prop_true)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors)) + 
  labs(title = "Correlation: Offline Rating T1 & True Choice", 
       x = "Offline Rating T1 Diff (easy - hard)", y = "Easy Choice Proportion") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))

# ggplot(df_cors_v2, aes(x = OfflineRating_T2Zs_diff, y = DCERs_true, label = PID)) +
ggplot(df_cors_v2, aes(x = OfflineRating_T2Zs_diff, y = DEC_prop_true)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: True Choice & Offline Rating T2", 
       x = "Offline Rating T2 Diff (easy - hard)", y = "Easy Choice Proportion") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))

# ggplot(df_cors_v2, aes(x = OfflineRating_T2Zs_diff, y = DCERs_false, label = PID)) +
ggplot(df_cors_v2, aes(x = OfflineRating_T2Zs_diff, y = DEC_prop_false)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: Offline Rating T2 & False Choice", 
       x = "Offline Rating T2 Diff (easy - hard)", y = "Easy Choice Proportion") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))

# ggplot(df_cors_v2, aes(x = DCERs_false, y = OfflineRating_T3Zs_diff, label = PID)) +
ggplot(df_cors_v2, aes(x = DEC_prop_false, y = OfflineRating_T3Zs_diff)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: False Choice & Offline Rating T3", 
       x = "Easy Choice Proportion", y = "Offline Rating T2 Diff (easy - hard)") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))
```

#### True Choice ~ False Choice
```{r}
# ggplot(df_cors_v2, aes(x = DEC_prop_true, y = DEC_prop_false, label = PID)) +
ggplot(df_cors_v2, aes(x = DEC_prop_true, y = DEC_prop_false)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation:True & False Choice", 
       x = "Easy Choice Proportion (True)", y = "Easy Choice Proportion (False)") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))

# ggplot(df_cors_v2, aes(x = DEC_prop_true, y = DEC_prop_false, label = PID)) +
ggplot(df_cors_v2, aes(x = DEC_prop_true, y = DEC_prop_false_10)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation:True & False Choice (1st section)", 
       x = "Easy Choice Proportion (True)", y = "Easy Choice Proportion (False 1-10)") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))

# ggplot(df_cors_v2, aes(x = DEC_prop_true, y = DEC_prop_false, label = PID)) +
ggplot(df_cors_v2, aes(x = DEC_prop_true, y = DEC_prop_false_20)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation:True & False Choice (2nd section)", 
       x = "Easy Choice Proportion (True)", y = "Easy Choice Proportion (False 11-20)") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))

# ggplot(df_cors_v2, aes(x = DEC_prop_true, y = DEC_prop_false, label = PID)) +
ggplot(df_cors_v2, aes(x = DEC_prop_true, y = DEC_prop_false_30)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation:True & False Choice (3rd section)", 
       x = "Easy Choice Proportion (True)", y = "Easy Choice Proportion (False 21-30)") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))

# ggplot(df_cors_v2, aes(x = DEC_prop_true, y = DEC_prop_false, label = PID)) +
ggplot(df_cors_v2, aes(x = DEC_prop_true, y = DEC_prop_false_40)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation:True & False Choice (4th section)", 
       x = "Easy Choice Proportion (True)", y = "Easy Choice Proportion (False 31-40)") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))

# ggplot(df_cors_v2, aes(x = DEC_prop_true, y = DEC_prop_false, label = PID)) +
ggplot(df_cors_v2, aes(x = DEC_prop_true, y = DEC_prop_false_50)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation:True & False Choice (5th section)", 
       x = "Easy Choice Proportion (True)", y = "Easy Choice Proportion (False 41-50)") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))
```


### Questionnaires
#### NFC
significant with False Easy Choice Probability
```{r}
# ggplot(df_cors_all_v2, aes(x = NFC_sum, y = OnlineRatingZs_diff, label = PID)) +
ggplot(df_cors_all_v2, aes(x = NFC_sum_Z, y = OnlineRatingZs_diff)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: Online Rating & NFC", 
       x = "NFC",
       y = "Online Rating Diff (easy - hard)") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))

# ggplot(df_cors_all_v2, aes(x = NFC_sum, y = DCERs_true, label = PID)) +
ggplot(df_cors_all_v2, aes(x = NFC_sum_Z, y = DEC_prop_true)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: NFC & True Choice", 
       x = "NFC", y = "Easy Choice Probability") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))

# ggplot(df_cors_all_v2, aes(x = NFC_sum, y = DCERs_false, label = PID)) +
ggplot(df_cors_all_v2, aes(x = NFC_sum_Z, y = DEC_prop_false)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: NFC & False Choice", 
       x = "NFC", y = "Easy Choice Probability") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))

# ggplot(df_cors_all_v2, aes(x = NFC_sum, y = DCERs_false, label = PID)) +
ggplot(df_cors_all_v2, aes(x = NFC_sum_Z, y = DEC_prop_false_10)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: NFC & False Choice (1-10)", 
       x = "NFC", y = "Easy Choice Probability") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))

# ggplot(df_cors_all_v2, aes(x = NFC_sum, y = DCERs_false, label = PID)) +
ggplot(df_cors_all_v2, aes(x = NFC_sum_Z, y = DEC_prop_false_20)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: NFC & False Choice (11-20)", 
       x = "NFC", y = "Easy Choice Probability") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))

# ggplot(df_cors_all_v2, aes(x = NFC_sum, y = DCERs_false, label = PID)) +
ggplot(df_cors_all_v2, aes(x = NFC_sum_Z, y = DEC_prop_false_30)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: NFC & False Choice (21-30)", 
       x = "NFC", y = "Easy Choice Probability") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))

# ggplot(df_cors_all_v2, aes(x = NFC_sum, y = DCERs_false, label = PID)) +
ggplot(df_cors_all_v2, aes(x = NFC_sum_Z, y = DEC_prop_false_40)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: NFC & False Choice (31-40)", 
       x = "NFC", y = "Easy Choice Probability") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))

# ggplot(df_cors_all_v2, aes(x = NFC_sum, y = DCERs_false, label = PID)) +
ggplot(df_cors_all_v2, aes(x = NFC_sum_Z, y = DEC_prop_false_50)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: NFC & False Choice (41-50)", 
       x = "NFC", y = "Easy Choice Probability") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))


# ggplot(df_cors_all_v2, aes(x = NFC_sum, y = DCERs_false, label = PID)) +
ggplot(df_cors_all_v2, aes(x = NFC_sum_Z, y = DEC_prop_false_drop)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: NFC & False Choice drop", 
       x = "NFC", y = "Easy Choice Probability") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))
```

#### BFI
no significant r with Online Rating; NEU seems to be most related.
```{r}
# ggplot(df_cors_all_v2, aes(x = BFI_NEU_sum_Z, y = OnlineRatingZs_diff, label = PID)) +
ggplot(df_cors_all_v2, aes(x = BFI_EXT_sum_Z, y = OnlineRatingZs_diff)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: Online & BFI_EXT", 
       x = "BFI_EXT",
       y = "Online Rating Diff (easy - hard)") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))


# ggplot(df_cors_all_v2, aes(x = BFI_NEU_sum_Z, y = OnlineRatingZs_diff, label = PID)) +
ggplot(df_cors_all_v2, aes(x = BFI_AGR_sum_Z, y = OnlineRatingZs_diff)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: Online & BFI_AGR", 
       x = "BFI_AGR",
       y = "Online Rating Diff (easy - hard)") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))


# ggplot(df_cors_all_v2, aes(x = BFI_NEU_sum_Z, y = OnlineRatingZs_diff, label = PID)) +
ggplot(df_cors_all_v2, aes(x = BFI_CON_sum_Z, y = OnlineRatingZs_diff)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: Online & BFI_CON", 
       x = "BFI_CON",
       y = "Online Rating Diff (easy - hard)") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))


# ggplot(df_cors_all_v2, aes(x = BFI_NEU_sum_Z, y = OnlineRatingZs_diff, label = PID)) +
ggplot(df_cors_all_v2, aes(x = BFI_NEU_sum_Z, y = OnlineRatingZs_diff)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: Online & BFI_NEU", 
       x = "BFI_NEU",
       y = "Online Rating Diff (easy - hard)") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))


# ggplot(df_cors_all_v2, aes(x = BFI_NEU_sum_Z, y = OnlineRatingZs_diff, label = PID)) +
ggplot(df_cors_all_v2, aes(x = BFI_OPEN_sum_Z, y = OnlineRatingZs_diff)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: Online & BFI_OPEN", 
       x = "BFI_OPEN",
       y = "Online Rating Diff (easy - hard)") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))
```


no significant r with Offline Rating T1; NEU seems most related.
```{r}
# ggplot(df_cors_all_v2, aes(x = BFI_NEU_sum_Z, y = OnlineRatingZs_diff, label = PID)) +
ggplot(df_cors_all_v2, aes(x = BFI_EXT_sum_Z, y = OfflineRating_T1Zs_diff)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: Offline T1 & BFI_EXT", 
       x = "BFI_EXT",
       y = "Online Rating Diff (easy - hard)") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))


# ggplot(df_cors_all_v2, aes(x = BFI_NEU_sum_Z, y = OnlineRatingZs_diff, label = PID)) +
ggplot(df_cors_all_v2, aes(x = BFI_AGR_sum_Z, y = OfflineRating_T1Zs_diff)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: Offline T1 & BFI_AGR", 
       x = "BFI_AGR",
       y = "Online Rating Diff (easy - hard)") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))


# ggplot(df_cors_all_v2, aes(x = BFI_NEU_sum_Z, y = OnlineRatingZs_diff, label = PID)) +
ggplot(df_cors_all_v2, aes(x = BFI_CON_sum_Z, y = OfflineRating_T1Zs_diff)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: Offline T1 & BFI_CON", 
       x = "BFI_CON",
       y = "Online Rating Diff (easy - hard)") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))



# ggplot(df_cors_all_v2, aes(x = BFI_NEU_sum_Z, y = OnlineRatingZs_diff, label = PID)) +
ggplot(df_cors_all_v2, aes(x = BFI_NEU_sum_Z, y = OfflineRating_T1Zs_diff)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: Offline T1 & BFI_NEU", 
       x = "BFI_NEU",
       y = "Online Rating Diff (easy - hard)") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))

# ggplot(df_cors_all_v2, aes(x = BFI_NEU_sum_Z, y = OnlineRatingZs_diff, label = PID)) +
ggplot(df_cors_all_v2, aes(x = BFI_NEU_sum_Z, y = OfflineRating_T2Zs_diff)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: Offline T2 & BFI_NEU", 
       x = "BFI_NEU",
       y = "Online Rating Diff (easy - hard)") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))

# ggplot(df_cors_all_v2, aes(x = BFI_NEU_sum_Z, y = OnlineRatingZs_diff, label = PID)) +
ggplot(df_cors_all_v2, aes(x = BFI_NEU_sum_Z, y = OfflineRating_T3Zs_diff)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: Offline T3 & BFI_NEU", 
       x = "BFI_NEU",
       y = "Online Rating Diff (easy - hard)") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))



# ggplot(df_cors_all_v2, aes(x = BFI_OPEN_sum_Z, y = OnlineRatingZs_diff, label = PID)) +
ggplot(df_cors_all_v2, aes(x = BFI_OPEN_sum_Z, y = OfflineRating_T1Zs_diff)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: Offline T1 & BFI_OPEN", 
       x = "BFI_OPEN",
       y = "Online Rating Diff (easy - hard)") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))
```


#### BAI
Online Rating
no significant
```{r}
# ggplot(df_cors_all_v2, aes(x = BFI_NEU_sum_Z, y = OnlineRatingZs_diff, label = PID)) +
ggplot(df_cors_all_v2, aes(x = BAS_D_sum_Z, y = OnlineRatingZs_diff)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: Online & BAS_D", 
       x = "BAS_D",
       y = "Online Rating Diff (easy - hard)") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))

# ggplot(df_cors_all_v2, aes(x = BFI_NEU_sum_Z, y = OnlineRatingZs_diff, label = PID)) +
ggplot(df_cors_all_v2, aes(x = BAS_FS_sum_Z, y = OnlineRatingZs_diff)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: Online & BAS_FS", 
       x = "BAS_FS",
       y = "Online Rating Diff (easy - hard)") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))

# ggplot(df_cors_all_v2, aes(x = BFI_NEU_sum_Z, y = OnlineRatingZs_diff, label = PID)) +
ggplot(df_cors_all_v2, aes(x = BAS_RR_sum_Z, y = OnlineRatingZs_diff)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: Online & BAS_RR", 
       x = "BAS_RR",
       y = "Online Rating Diff (easy - hard)") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))

# ggplot(df_cors_all_v2, aes(x = BFI_NEU_sum_Z, y = OnlineRatingZs_diff, label = PID)) +
ggplot(df_cors_all_v2, aes(x = BIS_sum_Z, y = OnlineRatingZs_diff)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: Online & BIS", 
       x = "BIS",
       y = "Online Rating Diff (easy - hard)") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))
```


```{r}
# ggplot(df_cors_all_v2, aes(x = BFI_NEU_sum_Z, y = OnlineRatingZs_diff, label = PID)) +
ggplot(df_cors_all_v2, aes(x = BAS_D_sum_Z, y = DEC_prop_true)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: True Easy Choice & BAS_D", 
       x = "BAS_D",
       y = "Easy Choice Probability") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))

# ggplot(df_cors_all_v2, aes(x = BFI_NEU_sum_Z, y = OnlineRatingZs_diff, label = PID)) +
ggplot(df_cors_all_v2, aes(x = BAS_FS_sum_Z, y = DEC_prop_true)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: True Easy Choice & BAS_FS", 
       x = "BAS_FS",
       y = "Easy Choice Probability") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))

# ggplot(df_cors_all_v2, aes(x = BFI_NEU_sum_Z, y = OnlineRatingZs_diff, label = PID)) +
ggplot(df_cors_all_v2, aes(x = BAS_RR_sum_Z, y = DEC_prop_true)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: True Easy Choice & BAS_RR", 
       x = "BAS_RR",
       y = "Easy Choice Probability") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))

# ggplot(df_cors_all_v2, aes(x = BFI_NEU_sum_Z, y = OnlineRatingZs_diff, label = PID)) +
ggplot(df_cors_all_v2, aes(x = BIS_sum_Z, y = DEC_prop_true)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: True Easy Choice & BIS", 
       x = "BIS",
       y = "Easy Choice Probability") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))
```


no correlated to True Choice; but correlated to False Choice.
```{r}
# ggplot(df_cors_all_v2, aes(x = BFI_NEU_sum_Z, y = OnlineRatingZs_diff, label = PID)) +
ggplot(df_cors_all_v2, aes(x = BAS_D_sum_Z, y = DEC_prop_false)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: False Easy Choice & BAS_D", 
       x = "BAS_D",
       y = "Easy Choice Probability") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))

# ggplot(df_cors_all_v2, aes(x = BFI_NEU_sum_Z, y = OnlineRatingZs_diff, label = PID)) +
ggplot(df_cors_all_v2, aes(x = BAS_FS_sum_Z, y = DEC_prop_false)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: False Easy Choice & BAS_FS", 
       x = "BAS_FS",
       y = "Easy Choice Probability") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))

# ggplot(df_cors_all_v2, aes(x = BFI_NEU_sum_Z, y = OnlineRatingZs_diff, label = PID)) +
ggplot(df_cors_all_v2, aes(x = BAS_RR_sum_Z, y = DEC_prop_false)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: False Easy Choice & BAS_RR", 
       x = "BAS_RR",
       y = "Easy Choice Probability") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))

# ggplot(df_cors_all_v2, aes(x = BFI_NEU_sum_Z, y = OnlineRatingZs_diff, label = PID)) +
ggplot(df_cors_all_v2, aes(x = BIS_sum_Z, y = DEC_prop_false)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: False Easy Choice & BIS", 
       x = "BIS",
       y = "Easy Choice Probability") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))
```



#### UPPS
Online Ratings
(Significant correlation with Lack of premeditation.)
```{r}
# ggplot(df_cors_all_v2, aes(x = NFC_sum, y = OnlineRatingZs_diff, label = PID)) +
ggplot(df_cors_all_v2, aes(x = UPPS_NU_sum_Z, y = OnlineRatingZs_diff)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: Online Rating & UPPS_NU", 
       x = "UPPS_NU",
       y = "Online Rating Diff (easy - hard)") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))

# ggplot(df_cors_all_v2, aes(x = NFC_sum, y = OnlineRatingZs_diff, label = PID)) +
ggplot(df_cors_all_v2, aes(x = UPPS_PU_sum_Z, y = OnlineRatingZs_diff)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: Online Rating & UPPS_PU", 
       x = "UPPS_PU",
       y = "Online Rating Diff (easy - hard)") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))

# ggplot(df_cors_all_v2, aes(x = NFC_sum, y = OnlineRatingZs_diff, label = PID)) +
ggplot(df_cors_all_v2, aes(x = UPPS_LPS_sum_Z, y = OnlineRatingZs_diff)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: Online Rating & UPPS_LPS", 
       x = "UPPS_LPS",
       y = "Online Rating Diff (easy - hard)") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))

# ggplot(df_cors_all_v2, aes(x = NFC_sum, y = OnlineRatingZs_diff, label = PID)) +
ggplot(df_cors_all_v2, aes(x = UPPS_LPM_sum_Z, y = OnlineRatingZs_diff)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: Online Rating & UPPS_LPM", 
       x = "UPPS_LPM",
       y = "Online Rating Diff (easy - hard)") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))

# ggplot(df_cors_all_v2, aes(x = NFC_sum, y = OnlineRatingZs_diff, label = PID)) +
ggplot(df_cors_all_v2, aes(x = UPPS_LPM_sum_Z, y = OnlineRatingZs_easy)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: Online Rating & UPPS_LPM", 
       x = "UPPS_LPM",
       y = "Online Rating Easy") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))

# ggplot(df_cors_all_v2, aes(x = NFC_sum, y = OnlineRatingZs_diff, label = PID)) +
ggplot(df_cors_all_v2, aes(x = UPPS_LPM_sum_Z, y = OnlineRatingZs_hard)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: Online Rating & UPPS_LPM", 
       x = "UPPS_LPM",
       y = "Online Rating Hard") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))
```

True choice
(No significant correlation.)
```{r}
# ggplot(df_cors_all_v2, aes(x = BFI_NEU_sum_Z, y = OnlineRatingZs_diff, label = PID)) +
ggplot(df_cors_all_v2, aes(x = UPPS_NU_sum_Z, y = DEC_prop_true)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: True Easy Choice & UPPS_NU", 
       x = "UPPS_NU",
       y = "Easy Choice Probability") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))

# ggplot(df_cors_all_v2, aes(x = BFI_NEU_sum_Z, y = OnlineRatingZs_diff, label = PID)) +
ggplot(df_cors_all_v2, aes(x = UPPS_PU_sum_Z, y = DEC_prop_true)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: True Easy Choice & UPPS_PU", 
       x = "UPPS_PU",
       y = "Easy Choice Probability") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))

# ggplot(df_cors_all_v2, aes(x = BFI_NEU_sum_Z, y = OnlineRatingZs_diff, label = PID)) +
ggplot(df_cors_all_v2, aes(x = UPPS_LPS_sum_Z, y = DEC_prop_true)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: True Easy Choice & UPPS_LPS", 
       x = "UPPS_LPS",
       y = "Easy Choice Probability") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))

# ggplot(df_cors_all_v2, aes(x = BFI_NEU_sum_Z, y = OnlineRatingZs_diff, label = PID)) +
ggplot(df_cors_all_v2, aes(x = UPPS_LPM_sum_Z, y = DEC_prop_true)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: True Easy Choice & UPPS_LPM", 
       x = "UPPS_LPM",
       y = "Easy Choice Probability") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))
```

False choice
(No significant correlation.)
```{r}
# ggplot(df_cors_all_v2, aes(x = BFI_NEU_sum_Z, y = OnlineRatingZs_diff, label = PID)) +
ggplot(df_cors_all_v2, aes(x = UPPS_NU_sum_Z, y = DEC_prop_false)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: False Easy Choice & UPPS_NU", 
       x = "UPPS_NU",
       y = "Easy Choice Probability") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))

# ggplot(df_cors_all_v2, aes(x = BFI_NEU_sum_Z, y = OnlineRatingZs_diff, label = PID)) +
ggplot(df_cors_all_v2, aes(x = UPPS_PU_sum_Z, y = DEC_prop_false)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: False Easy Choice & UPPS_PU", 
       x = "UPPS_PU",
       y = "Easy Choice Probability") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))

# ggplot(df_cors_all_v2, aes(x = BFI_NEU_sum_Z, y = OnlineRatingZs_diff, label = PID)) +
ggplot(df_cors_all_v2, aes(x = UPPS_LPS_sum_Z, y = DEC_prop_false)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: False Easy Choice & UPPS_LPS", 
       x = "UPPS_LPS",
       y = "Easy Choice Probability") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))

# ggplot(df_cors_all_v2, aes(x = BFI_NEU_sum_Z, y = OnlineRatingZs_diff, label = PID)) +
ggplot(df_cors_all_v2, aes(x = UPPS_LPM_sum_Z, y = DEC_prop_false)) +
  geom_point() + 
  geom_smooth(method = "lm") +
  stat_cor(method = "spearman")+
  # geom_text_repel(max.overlaps = nrow(df_cors_v2)) + 
  labs(title = "Correlation: False Easy Choice & UPPS_LPM", 
       x = "UPPS_LPM",
       y = "Easy Choice Probability") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))
```




## Regressions
### Online Rating ~ Task Demand
Y: All
```{r}
reg.m1.1_lmerTest_v2 <- 
  df_v2_good_LEARNING %>% 
  lmerTest::lmer(OnlineRatingZ ~ TaskDemand*TrialN + RT_preZ + ACC_preZ + 
                   (TaskDemand|TrialN) + 
                   (TaskDemand|TrialTransition_pre) + (TaskDemand|TrialDemandLearning_pre) +
                   (1|PID) + (1|Gender) + (1|CueMapping) + (1|ISI),
                 data = .)
# summary(reg.m1.1_lmerTest_v2)
tab_model(reg.m1.1_lmerTest_v2,
          show.re.var = FALSE, show.ngroups = FALSE
          )
```


```{r}
emtrends(reg.m1.1_lmerTest_v2, ~TaskDemand, var="TrialN")
```

```{r}
mod_levels <- list(TrialN=seq(1,50,1), TaskDemand=c("easy", "hard"))
```


```{r}
reg.m1.1_emmeans <- emmeans(reg.m1.1_lmerTest_v2, ~TaskDemand*TrialN, at=mod_levels)

reg.m1.1_contrast <- contrast(reg.m1.1_emmeans, "pairwise", by="TrialN")
# contrast between demands in each participant
```

interaction plot
```{r}
emmip(reg.m1.1_lmerTest_v2, TaskDemand ~ TrialN, at=mod_levels) +
  scale_color_lancet()+
  labs(title = "Regression: Online Rating ~ TaskDemand*TrialN", 
       x = "TrialN",
       y = "Online Rating (z-scored)",
       color = "Task Demand") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))
```

```{r}
plot_model(reg.m1.1_lmerTest_v2, type = "pred", terms = c("TrialN", "TaskDemand"),
           colors = c("#00468BFF", "#ED0000FF"),
           # show.data = TRUE, jitter = 0.5, 
           show.values = TRUE, show.p = TRUE)+
  labs(title = "Regression: Online Rating ~ TaskDemand*TrialN", 
       x = "TrialN",
       y = "Online Rating (z-scored)",
       color = "Task Demand") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))
```

Y: online ratings in 5th section
```{r}
reg.m1.2_lmerTest_v2 <- 
  df_v2_good_LEARNING %>% 
  filter(TrialN %in% c(seq(40,50))) %>% 
  lmerTest::lmer(OnlineRatingZ ~ TaskDemand*TrialN + RT_preZ + ACC_preZ + 
                   (TaskDemand | TrialN) +
                   (TaskDemand|TrialTransition_pre) + (TaskDemand|TrialDemandLearning_pre) +
                   (1|PID) + (1|Gender) + (1|CueMapping) + (1|ISI) + (1|TrialN),
                 data = .)
tab_model(reg.m1.2_lmerTest_v2)
# not significant
```

```{r}
plot_model(reg.m1.2_lmerTest_v2, type = "pred", terms = c("TrialN", "TaskDemand"),
           colors = c("#00468BFF", "#ED0000FF"),
           # show.data = TRUE, jitter = 0.5, 
           show.values = TRUE, show.p = TRUE)+
  labs(title = "Regression: Online Rating (5th section) ~ TaskDemand*TrialN", 
       x = "TrialN",
       y = "Online Rating (z-scored)",
       color = "Task Demand") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))
```




Compare models
```{r}
tab_model(reg.m1.1_lmerTest_v2, reg.m1.2_lmerTest_v2,
          show.re.var = FALSE, show.ngroups = FALSE,
          dv.labels = c("OnlineRatingZ", "OnlineRatingZ in 40-50 Trial Section"),
          file = "E:/Dissertation/Methods/Exp2_Demand_Choice/DARDCpy_v2/data_analysis/reg_m1_v2.html")
```

(AIC counts more on model fitness; BIC counts more on model simplicity. Smaller value, better model)
```{r}
AIC(logLik(reg.m1.1_lmerTest_v2))
AIC(logLik(reg.m1.2_lmerTest_v2))
```

```{r}
# higher penalty on complex models than AIC
BIC(logLik(reg.m1.1_lmerTest_v2))
BIC(logLik(reg.m1.2_lmerTest_v2))
```


with Personalities' random effects
```{r}
df_cors_all_v2_pure <- 
  df_cors_all_v2 %>% 
  select(-c(Gender, ISI))

df_v2_good_LEARNING_ques <- 
  df_v2_good_LEARNING %>% 
  merge(df_cors_all_v2_pure, by.x = "PID", by.y = "PID", all.x = TRUE) 
```

```{r}
reg.m1.3_lmerTest_v2 <- 
  df_v2_good_LEARNING_ques %>% 
  lmerTest::lmer(OnlineRatingZ ~ TaskDemand*TrialN + RT_preZ + ACC_preZ +
                   NFC_sum_Z +
                  BFI_NEU_sum_Z + BFI_AGR_sum_Z + BFI_CON_sum_Z + BFI_EXT_sum_Z + BFI_OPEN_sum_Z +
                  BAS_D_sum_Z + BAS_FS_sum_Z + BIS_sum_Z +
                  UPPS_NU_sum_Z + UPPS_PU_sum_Z + UPPS_LPS_sum_Z + UPPS_LPM_sum_Z +
                   (0 + TaskDemand|TrialN) + 
                   (0 + TaskDemand|TrialTransition_pre) + (0 + TaskDemand|TrialDemandLearning_pre) +
                   (1 | Gender) + (1|CueMapping.x) + (1|ISI) +
                   (1 | NFC_sum_Z) +
                   (1 | BFI_NEU_sum_Z) +
                   (1 | BFI_AGR_sum_Z) +
                   (1 | BFI_CON_sum_Z) +
                   (1 | BFI_EXT_sum_Z) +
                   (1 | BFI_OPEN_sum_Z) +
                   (1 | BAS_D_sum_Z) + (1 | BAS_FS_sum_Z) +
                   (1 | BIS_sum_Z) +
                   (1 | UPPS_NU_sum_Z) + (1 | UPPS_PU_sum_Z) +
                   (1 | UPPS_LPS_sum_Z) + (1 | UPPS_LPM_sum_Z),
                 data = .)
tab_model(reg.m1.3_lmerTest_v2, show.re.var = FALSE, show.ngroups = FALSE)
```

```{r}
plot_model(reg.m1.3_lmerTest_v2, type = "pred", terms = c("TrialN", "TaskDemand"),
           colors = c("#00468BFF", "#ED0000FF"),
           # show.data = TRUE, jitter = 0.5, 
           show.values = TRUE, show.p = TRUE)+
  labs(title = "Regression: Online Rating ~ TaskDemand*TrialN", 
       x = "TrialN",
       y = "Online Rating (z-scored)",
       color = "Task Demand") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))
```



### Online Rating Diff ~ Personalities
Y: All
```{r}
reg.m1.4_lmerTest_v2 <- 
  df_cors_all_v2 %>% 
  lmerTest::lmer(OnlineRatingZs_diff ~ 
                  NFC_sum_Z +
                  BFI_NEU_sum_Z + BFI_AGR_sum_Z + BFI_CON_sum_Z + BFI_EXT_sum_Z + BFI_OPEN_sum_Z +
                  BAS_D_sum_Z + BAS_FS_sum_Z + BIS_sum_Z +
                  UPPS_NU_sum_Z + UPPS_PU_sum_Z + UPPS_LPS_sum_Z + UPPS_LPM_sum_Z +
                   (1|Gender) + (1|CueMapping) + (1|ISI),
                 data = .)
tab_model(reg.m1.4_lmerTest_v2)
# no personality had significant effect
```

Y: ratings in 5th section
```{r}
reg.m1.5_lmerTest_v2 <- 
  df_cors_all_v2 %>% 
  lmerTest::lmer(OnlineRatingZ_diff_50 ~ 
                  NFC_sum_Z +
                  BFI_NEU_sum_Z + BFI_AGR_sum_Z + BFI_CON_sum_Z + BFI_EXT_sum_Z + BFI_OPEN_sum_Z +
                  BAS_D_sum_Z + BAS_FS_sum_Z + BIS_sum_Z +
                  UPPS_NU_sum_Z + UPPS_PU_sum_Z + UPPS_LPS_sum_Z + UPPS_LPM_sum_Z +
                   (1|Gender) + (1|CueMapping) + (1|ISI),
                 data = .)
tab_model(reg.m1.5_lmerTest_v2)
# no personality had significant effect
```



### True Choice ~ Affective Ratings
#### Online Rating
Y: All trials
```{r}
reg.m2.1_lmerTest_v2 <- 
  df_cors_all_v2 %>% 
  lmerTest::lmer(DEC_prop_true ~ OnlineRatingZs_diff + 
                  # NFC_sum_Z +
                  # BFI_NEU_sum_Z + BFI_AGR_sum_Z + BFI_CON_sum_Z + BFI_EXT_sum_Z + BFI_OPEN_sum_Z +
                  # BAS_D_sum_Z + BAS_FS_sum_Z + BIS_sum_Z +
                  # UPPS_NU_sum_Z + UPPS_PU_sum_Z + UPPS_LPS_sum_Z + UPPS_LPM_sum_Z +
                   (1|Gender) + (1|CueMapping) + (1|ISI),
                 data = .)
tab_model(reg.m2.1_lmerTest_v2)
# no personality had significant effect
```

Trial Section 40-50 Online Rating
```{r}
reg.m2.2_lmerTest_v2 <- 
  df_cors_all_v2 %>% 
  lmerTest::lmer(DEC_prop_true ~ OnlineRatingZ_diff_50 + 
                  NFC_sum_Z +
                  BFI_NEU_sum_Z + BFI_AGR_sum_Z + BFI_CON_sum_Z + BFI_EXT_sum_Z + BFI_OPEN_sum_Z +
                  BAS_D_sum_Z + BAS_FS_sum_Z + BIS_sum_Z +
                  UPPS_NU_sum_Z + UPPS_PU_sum_Z + UPPS_LPS_sum_Z + UPPS_LPM_sum_Z +
                   (1|Gender) + (1|CueMapping) + (1|ISI),
                 data = .)
tab_model(reg.m2.2_lmerTest_v2)
```


Compare models

(AIC counts more on model fitness; BIC counts more on model simplicity. Smaller value, better model)
```{r}
AIC(logLik(reg.m2.1_lmerTest_v2))
AIC(logLik(reg.m2.2_lmerTest_v2))
```

```{r}
# higher penalty on complex models than AIC
BIC(logLik(reg.m2.1_lmerTest_v2))
BIC(logLik(reg.m2.2_lmerTest_v2))
```



#### Offline Rating
```{r}
reg.m2.3_lmerTest_v2 <- 
  df_cors_all_v2 %>% 
  lmerTest::lmer(DEC_prop_true ~ OfflineRating_T1Zs_diff + 
                  # NFC_sum_Z +
                  # BFI_NEU_sum_Z + BFI_AGR_sum_Z + BFI_CON_sum_Z + BFI_EXT_sum_Z + BFI_OPEN_sum_Z +
                  # BAS_D_sum_Z + BAS_FS_sum_Z + BIS_sum_Z +
                  # UPPS_NU_sum_Z + UPPS_PU_sum_Z + UPPS_LPS_sum_Z + UPPS_LPM_sum_Z +
                   (1|Gender) + (1|CueMapping) + (1|ISI),
                 data = .)
tab_model(reg.m2.3_lmerTest_v2)
# no personality had significant effect
```

```{r}
reg.m2.4_lmerTest_v2 <- 
  df_cors_all_v2 %>% 
  lmerTest::lmer(OfflineRating_T2Zs_diff ~ DEC_prop_true + 
                  NFC_sum_Z +
                  BFI_NEU_sum_Z + BFI_AGR_sum_Z + BFI_CON_sum_Z + BFI_EXT_sum_Z + BFI_OPEN_sum_Z +
                  BAS_D_sum_Z + BAS_FS_sum_Z + BIS_sum_Z +
                  UPPS_NU_sum_Z + UPPS_PU_sum_Z + UPPS_LPS_sum_Z + UPPS_LPM_sum_Z +
                   (1|Gender) + (1|CueMapping) + (1|ISI),
                 data = .)
tab_model(reg.m2.4_lmerTest_v2)
# no personality had significant effect
```

Compare models
(AIC counts more on model fitness; BIC counts more on model simplicity. Smaller value, better model)
```{r}
AIC(logLik(reg.m2.3_lmerTest_v2))
AIC(logLik(reg.m2.4_lmerTest_v2))
```

```{r}
# higher penalty on complex models than AIC
BIC(logLik(reg.m2.3_lmerTest_v2))
BIC(logLik(reg.m2.4_lmerTest_v2))
```


output
```{r}
tab_model(reg.m2.1_lmerTest_v2, reg.m2.2_lmerTest_v2, reg.m2.3_lmerTest_v2, reg.m2.4_lmerTest_v2,
          show.re.var = FALSE, show.ngroups = FALSE,
          file = "E:/Dissertation/Methods/Exp2_Demand_Choice/DARDCpy_v2/data_analysis/reg_m2_v2.html")
```



### False Choice ~ Affective Ratings
#### Online Rating
Y: All trials
```{r}
reg.m3.1_lmerTest_v2 <- 
  df_cors_all_v2 %>% 
  lmerTest::lmer(DEC_prop_false ~ OnlineRatingZs_diff + 
                   # NFC_sum_Z +
                   # BFI_NEU_sum_Z + BFI_AGR_sum_Z + BFI_CON_sum_Z + BFI_EXT_sum_Z + BFI_OPEN_sum_Z +
                   # BAS_D_sum_Z + BAS_FS_sum_Z + BIS_sum_Z +
                   # UPPS_NU_sum_Z + UPPS_PU_sum_Z + UPPS_LPS_sum_Z + UPPS_LPM_sum_Z +
                   (1|Gender) + (1|CueMapping) + (1|ISI),
                 data = .)
tab_model(reg.m3.1_lmerTest_v2)
# no personality had significant effect
```

Y: in the 5th section
```{r}
reg.m3.2_lmerTest_v2 <- 
  df_cors_all_v2 %>% 
  lmerTest::lmer(DEC_prop_false ~ OnlineRatingZ_diff_50 + 
                  # NFC_sum_Z +
                  # BFI_NEU_sum_Z + BFI_AGR_sum_Z + BFI_CON_sum_Z + BFI_EXT_sum_Z + BFI_OPEN_sum_Z +
                  # BAS_D_sum_Z + BAS_FS_sum_Z + BIS_sum_Z +
                  # UPPS_NU_sum_Z + UPPS_PU_sum_Z + UPPS_LPS_sum_Z + UPPS_LPM_sum_Z +
                   (1|Gender) + (1|CueMapping) + (1|ISI),
                 data = .)
tab_model(reg.m3.2_lmerTest_v2)
# no more personality had significant effect beside Online Rating
```

Compare models
(AIC counts more on model fitness; BIC counts more on model simplicity. Smaller value, better model)
```{r}
AIC(logLik(reg.m3.1_lmerTest_v2))
AIC(logLik(reg.m3.2_lmerTest_v2))
```

```{r}
# higher penalty on complex models than AIC
BIC(logLik(reg.m3.1_lmerTest_v2))
BIC(logLik(reg.m3.2_lmerTest_v2))
```




#### Offline Rating T2
```{r}
reg.m3.3_lmerTest_v2 <- 
  df_cors_all_v2 %>% 
  lmerTest::lmer(DEC_prop_false ~ OfflineRating_T2Zs_diff +
                  # NFC_sum_Z +
                  # BFI_NEU_sum_Z + BFI_AGR_sum_Z + BFI_CON_sum_Z + BFI_EXT_sum_Z + BFI_OPEN_sum_Z +
                  # BAS_D_sum_Z + BAS_FS_sum_Z + BIS_sum_Z +
                  # UPPS_NU_sum_Z + UPPS_PU_sum_Z + UPPS_LPS_sum_Z + UPPS_LPM_sum_Z + 
                   (1|Gender) + (1|CueMapping) + (1|ISI),
                 data = .)
tab_model(reg.m3.3_lmerTest_v2)
# no more personality had significant effect beside Offline Rating
```

#### Offline Rating T3
```{r}
reg.m3.4_lmerTest_v2 <- 
  df_cors_all_v2 %>% 
  lmerTest::lmer(OfflineRating_T3Zs_diff ~ DEC_prop_false + 
                  NFC_sum_Z +
                  BFI_NEU_sum_Z + BFI_AGR_sum_Z + BFI_CON_sum_Z + BFI_EXT_sum_Z + BFI_OPEN_sum_Z +
                  BAS_D_sum_Z + BAS_FS_sum_Z + BIS_sum_Z +
                  UPPS_NU_sum_Z + UPPS_PU_sum_Z + UPPS_LPS_sum_Z + UPPS_LPM_sum_Z +
                   (1|Gender) + (1|CueMapping) + (1|ISI),
                 data = .)
tab_model(reg.m3.4_lmerTest_v2)
# no more personality had significant effect beside Offline Rating
```


```{r}
tab_model(reg.m3.1_lmerTest_v2, reg.m3.2_lmerTest_v2, reg.m3.3_lmerTest_v2, reg.m3.4_lmerTest_v2,
          show.re.var = FALSE, show.ngroups = FALSE,
          file = "E:/Dissertation/Methods/Exp2_Demand_Choice/DARDCpy_v2/data_analysis/reg_m3_v2.html")
```


```{r}
tab_model(reg.m2.1_lmerTest_v2, 
          reg.m3.1_lmerTest_v2, 
          reg.m2.3_lmerTest_v2, reg.m3.3_lmerTest_v2,
          show.re.var = FALSE, show.ngroups = FALSE)
```



#### Logistic Regression of Flase Choice
```{r}
df_cors_all_v2_pure <- 
  df_cors_all_v2 %>% 
  dplyr::select(-c(Gender, ISI))

df_v2_good_FALSECHOICE_logistic <- 
  df_v2_good_FALSECHOICE %>% 
  merge(df_cors_all_v2_pure, by.x = "PID", by.y = "PID", all.x = TRUE) 
```

```{r}
reg.log.false1 <- 
  df_v2_good_FALSECHOICE_logistic %>% 
  glmer(DemandChoice_code ~ TrialN + 
          OnlineRatingZs_diff + 
          OfflineRating_T1Zs_diff + OfflineRating_T2Zs_diff +
          DEC_prop_true + 
          (0 + TrialN|OnlineRatingZs_diff) + 
          (0 + TrialN|OfflineRating_T1Zs_diff) + (0 + TrialN|OfflineRating_T2Zs_diff) + 
          (0 + TrialN|DEC_prop_true)+ 
          # NFC_sum_Z +
          # BFI_NEU_sum_Z + BFI_AGR_sum_Z + BFI_CON_sum_Z + BFI_EXT_sum_Z + BFI_OPEN_sum_Z +
          # BAS_D_sum_Z + BAS_FS_sum_Z + BIS_sum_Z +
          # UPPS_NU_sum_Z + UPPS_PU_sum_Z + UPPS_LPS_sum_Z + UPPS_LPM_sum_Z +
          (1 | PID) + (1 | Gender) + (1 | ISI),
          # (1 | TrialN/Gender) +
          # (1 | TrialN/ISI)  +
          # (1 | TrialN/NFC_sum_Z) +
          # (1 | TrialN/BFI_NEU_sum_Z) +
          # (1 | TrialN/BFI_AGR_sum_Z) +
          # (1 | TrialN/BFI_CON_sum_Z) +
          # (1 | TrialN/BFI_EXT_sum_Z) +
          # (1 | TrialN/BFI_OPEN_sum_Z) +
          # (1 | TrialN/BAS_D_sum_Z) + (1 | TrialN/BAS_FS_sum_Z) +
          # (1 | TrialN/BIS_sum_Z) +
          # (1 | TrialN/UPPS_NU_sum_Z) + (1 | TrialN/UPPS_PU_sum_Z) +
          # (1 | TrialN/UPPS_LPS_sum_Z) + (1 | TrialN/UPPS_LPM_sum_Z)
       data = ., 
       family = binomial)
tab_model(reg.log.false1, dv.labels = c("ChoiceDemand"),
          show.re.var = FALSE, show.ngroups = FALSE)
```


```{r}
reg.log.false2 <- 
  df_v2_good_FALSECHOICE_logistic %>% 
  glmer(DemandChoice_code ~ TrialN*DemandAversive_on +
          TrialN*DemandAversive_off_T1 +
          TrialN*DemandAversive_off_T2 +
          TrialN*DemandAversive_off_T3 +
          TrialN*DemandAvoidance_true + 
          # OfflineRating_T1Zs_diff + OfflineRating_T2Zs_diff +
          # DEC_prop_true + 
          (1 + TrialN|DemandAversive_on) +
          (1 + TrialN|DemandAversive_off_T1) +
          (1 + TrialN|DemandAversive_off_T2) +
          (1 + TrialN|DemandAversive_off_T3) +
          # (0 + TrialN|OfflineRating_T1Zs_diff) + (0 + TrialN|OfflineRating_T2Zs_diff) + 
          (1 + TrialN|DemandAvoidance_true)+ 
          # NFC_sum_Z +
          # BFI_NEU_sum_Z + BFI_AGR_sum_Z + BFI_CON_sum_Z + BFI_EXT_sum_Z + BFI_OPEN_sum_Z +
          # BAS_D_sum_Z + BAS_FS_sum_Z + BIS_sum_Z +
          # UPPS_NU_sum_Z + UPPS_PU_sum_Z + UPPS_LPS_sum_Z + UPPS_LPM_sum_Z +
          (1 | PID) + (1 | Gender) + (1 | ISI),
          # (1 | TrialN/Gender) +
          # (1 | TrialN/ISI)  +
          # (1 | TrialN/NFC_sum_Z) +
          # (1 | TrialN/BFI_NEU_sum_Z) +
          # (1 | TrialN/BFI_AGR_sum_Z) +
          # (1 | TrialN/BFI_CON_sum_Z) +
          # (1 | TrialN/BFI_EXT_sum_Z) +
          # (1 | TrialN/BFI_OPEN_sum_Z) +
          # (1 | TrialN/BAS_D_sum_Z) + (1 | TrialN/BAS_FS_sum_Z) +
          # (1 | TrialN/BIS_sum_Z) +
          # (1 | TrialN/UPPS_NU_sum_Z) + (1 | TrialN/UPPS_PU_sum_Z) +
          # (1 | TrialN/UPPS_LPS_sum_Z) + (1 | TrialN/UPPS_LPM_sum_Z)
       data = ., 
       family = binomial)
tab_model(reg.log.false2, dv.labels = c("ChoiceDemand"),
          show.re.var = FALSE, show.ngroups = FALSE)
```
interaction plot
```{r}
plot_model(reg.log.false2, type = "pred", 
           terms = c("TrialN[all]", "DemandAversive_off_T3"),
           colors = c("#1f77b4", "#ff7f0e"),
           # show.data = TRUE, jitter = 0.5, 
           show.values = TRUE, show.p = TRUE)+
  labs(title = "Logistic Regression: False Choice ~ DemandAversive_off_T3*TrialN", 
       x = "TrialN",
       y = "Easy Choice Probability",
       color = "DemandAversive_off_T3") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))
```

```{r}
plot_model(reg.log.false2, type = "pred", 
           terms = c("TrialN[all]", "DemandAvoidance_true"),
           colors = c("#1f77b4", "#ff7f0e"),
           # show.data = TRUE, jitter = 0.5, 
           show.values = TRUE, show.p = TRUE)+
  labs(title = "Logistic Regression: False Choice ~ DemandAvoidance_true*TrialN", 
       x = "TrialN",
       y = "Easy Choice Probability",
       color = "DemandAvoidance_true") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))
```



### Mediation Analysis
```{r}
med_model <- 
  df_cors_all_v2 %>% 
  lm(data=., DEC_prop_true ~ OnlineRatingZs_diff )

out_model <- 
  df_cors_all_v2 %>% 
  lm(data=.,DEC_prop_false ~ OnlineRatingZs_diff +
                   DEC_prop_true)

reg.med1_v2 <- 
  mediate(model.m = med_model,
          model.y = out_model,
          treat = "OnlineRatingZs_diff",
          mediator = "DEC_prop_true",
          control.value = 3,
          treat.value = 4,
          boot = TRUE,
          sims = 100)

summary(reg.med1_v2)
# ACME: Average Causal Mediation Effects
# ADE: Average Direct Effects
# chrome-extension://efaidnbmnnnibpcajpcglclefindmkaj/https://cran.r-project.org/web/packages/mediation/vignettes/mediation.pdf
```

```{r}
covs <- 
  c("Gender", "CueMapping", "ISI",
    "NFC_sum_Z",
    "BFI_NEU_sum_Z","BFI_AGR_sum_Z","BFI_CON_sum_Z","BFI_EXT_sum_Z","BFI_OPEN_sum_Z",
      "BAS_D_sum_Z","BAS_FS_sum_Z"," BIS_sum_Z",
       "UPPS_NU_sum_Z","UPPS_PU_sum_Z","UPPS_LPS_sum_Z","UPPS_LPM_sum_Z")

med_model <- 
  df_cors_all_v2 %>% 
  lm(data=.,
       DEC_prop_true ~ OnlineRatingZs_diff +
         Gender + CueMapping + ISI +
       NFC_sum_Z +
       BFI_NEU_sum_Z + BFI_AGR_sum_Z + BFI_CON_sum_Z + BFI_EXT_sum_Z + BFI_OPEN_sum_Z +
       BAS_D_sum_Z + BAS_FS_sum_Z + BIS_sum_Z +
       UPPS_NU_sum_Z + UPPS_PU_sum_Z + UPPS_LPS_sum_Z + UPPS_LPM_sum_Z
       ,)

out_model <- 
  df_cors_all_v2 %>% 
  lm(data=.,
       DEC_prop_false ~ OnlineRatingZs_diff +
         DEC_prop_true +
         Gender + CueMapping + ISI+
       NFC_sum_Z +
       BFI_NEU_sum_Z + BFI_AGR_sum_Z + BFI_CON_sum_Z + BFI_EXT_sum_Z + BFI_OPEN_sum_Z +
       BAS_D_sum_Z + BAS_FS_sum_Z + BIS_sum_Z +
       UPPS_NU_sum_Z + UPPS_PU_sum_Z + UPPS_LPS_sum_Z + UPPS_LPM_sum_Z
     ,)

reg.med2_v2 <- 
  mediate(model.m = med_model,
          model.y = out_model,
          treat = "OnlineRatingZs_diff",
          mediator = "DEC_prop_true",
          covariates = covs,
          sims = 100)

summary(reg.med2_v2)
```






### Exporatory Analysis
#### Choice RT
```{r}
df_False_Choice_RT_outliers <- 
  df_False_Choice %>%
  group_by(PID) %>% 
  filter(abs(scale(ChoiceRT)) >= 2.5) %>% 
  # ungroup() %>%
  summarise(ChoiceRT=mean(ChoiceRT, na.rm=TRUE), .groups = "drop")
```

#### Trial Performance ~ Online Rating
```{r}
reg.m4.1_lmerTest_v2 <- 
  df_v2_good_LEARNING %>% 
  lmerTest::lmer(RTZ ~ OnlineRatingZ + TaskDemand*TrialN + 
                   RT_preZ + ACC_preZ + Trial_A_measure_pre +
                   (1 + TaskDemand|TrialN) + (1 |TrialTransition_pre) + (1 |TrialDemandLearning_pre) +
                   (1| PID) + (1 | ISI) + (1 | CueMapping) + (1 | Gender), 
                 data = .)
# summary(reg.m4.1_lmerTest_v2)
```

```{r}
reg.m4.2_lmerTest_v2 <- 
  df_v2_good_LEARNING %>% 
  lmerTest::lmer(ACCZ ~ OnlineRatingZ + TaskDemand*TrialN + 
                   RT_preZ + ACC_preZ + Trial_A_measure_pre +
                   (1 + TaskDemand|TrialN) + (1 |TrialTransition_pre) + (1 |TrialDemandLearning_pre) +
                   (1| PID) + (1 | ISI) + (1 | CueMapping) + (1 | Gender), 
                 data = .)
```

```{r}
reg.m4.3_lmerTest_v2 <- 
  df_v2_good_LEARNING %>% 
  lmerTest::lmer(Trial_A_measure ~ OnlineRatingZ + TaskDemand*TrialN + 
                   RT_preZ + ACC_preZ + Trial_A_measure_pre +
                   (1 + TaskDemand|TrialN) + (1 |TrialTransition_pre) + (1 |TrialDemandLearning_pre) +
                   (1| PID) + (1 | ISI) + (1 | CueMapping) + (1 | Gender), 
                 data = .)
```

```{r}
tab_model(reg.m4.1_lmerTest_v2, reg.m4.2_lmerTest_v2, reg.m4.3_lmerTest_v2,
          show.re.var = FALSE, show.ngroups = FALSE,
          file = "E:/Dissertation/Methods/Exp2_Demand_Choice/DARDCpy_v2/data_analysis/reg_m4_v2.html")
```










#### RL-DDM
False Choice Phase
```{r}
df_v2_good_FALSECHOICE_rlddm <- 
  df_v2_good_FALSECHOICE_remove_outliers %>% 
  merge(df_cors_all_v2_pure, by.x = "PID", by.y = "PID", all.x = TRUE) %>% 
  dplyr::select(c(PID, ChoiceRT, ChoiceDemand, TaskDemand, TrialN,
         DemandAversive_on,
         DemandAversive_off_T1, DemandAversive_off_T2, DemandAversive_off_T3,
         DemandAvoidance_true))
df_v2_good_FALSECHOICE_rlddm_format <- 
  df_v2_good_FALSECHOICE_rlddm %>% 
  mutate(response = ifelse(ChoiceDemand == "easy", 0, 1),
         rt = ChoiceRT, # in seconds
         split_by = ifelse(ChoiceDemand == "easy", 0, 1),
         feedback = ifelse(ChoiceDemand == "easy", -1, 1),
         q_init = ifelse(DemandAversive_on == "demand_aversive", 0, 1)) %>% 
  rename(subj_idx = PID,
         trial = TrialN)
```

```{r}

write.csv(df_v2_good_FALSECHOICE_rlddm_format,
          "/Users/ottolab/Desktop/Yue/DARDC_v2_Data_Analysis/rlddm_false_choice.csv",
          row.names = FALSE)
```



```{r}
histogram(df_v2_good_FALSECHOICE_rlddm_format$rt[df_v2_good_FALSECHOICE_rlddm_format$subj_idx == 49], breaks = 20)
# PID 49 once caused extreme estimated value of parameter t in RLDDM gelman rubin statistics) 
# PID 117 once caused extreme estimated value of parameter t in RLDDM gelman rubin statistics) 
```





Learning Phase
```{r}

```


# Tutorial of R Notebook

{r} or {bash} or {python} # indicate what language is used in code


This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.



